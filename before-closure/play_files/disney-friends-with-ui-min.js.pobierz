var _____WB$wombat$assign$function_____ = function(name) {return (self._wb_wombat && self._wb_wombat.local_init && self._wb_wombat.local_init(name)) || self[name]; };
if (!self.__WB_pmw) { self.__WB_pmw = function(obj) { this.__WB_source = obj; return this; } }
{
  let window = _____WB$wombat$assign$function_____("window");
  let self = _____WB$wombat$assign$function_____("self");
  let document = _____WB$wombat$assign$function_____("document");
  let location = _____WB$wombat$assign$function_____("location");
  let top = _____WB$wombat$assign$function_____("top");
  let parent = _____WB$wombat$assign$function_____("parent");
  let frames = _____WB$wombat$assign$function_____("frames");
  let opener = _____WB$wombat$assign$function_____("opener");

var Disney=Disney||{};
Disney.Social={debugMode:false,currentLand:"disney:land:clubpenguin",ieVer:-1,pageLang:"en",init:function(){this.getPageLang();this.augmentTypes();if(typeof jQuery!=="undefined")jQuery.fn.allData=function(){var a=jQuery.data(this.get(0));return jQuery.cache[a]};if(typeof Strophe!=="undefined"){Strophe.Connection.prototype.connect=this.stropheConnect;Strophe.Connection.prototype._original_connect_cb=Strophe.Connection.prototype._connect_cb;Strophe.Connection.prototype._connect_cb=this.stropheConnectCb;
Strophe._originalSerialize=Strophe.serialize;Strophe.serialize=this.stropheSerialize;Strophe.log=function(a,b){a===Strophe.LogLevel.WARN&&Disney.Social.RemoteLogging.log(Disney.Social.RemoteLogging.Code.STROPHE_WARN,b);a>=Strophe.LogLevel.ERROR&&Disney.Social.RemoteLogging.log(Disney.Social.RemoteLogging.Code.STROPHE_ERROR,b)}}},getPageLang:function(){var a="en";if(document.documentElement.lang!==undefined&&document.documentElement.lang!==null)a=document.documentElement.lang.toLowerCase();return this.pageLang=
a},stropheConnect:function(a,b,c,d,e,f){this.jid=a;this.pass=b;this.connect_callback=c;this.authenticated=this.connected=this.disconnecting=false;this.errors=0;this.wait=e||this.wait;this.hold=f||this.hold;this.domain=Strophe.getDomainFromJid(this.jid);a=this._buildBody().attrs({to:this.domain,"xml:lang":d,wait:this.wait,hold:this.hold,content:"text/xml; charset=utf-8",ver:"1.6","xmpp:version":"1.0","xmlns:xmpp":Strophe.NS.BOSH});this._changeConnectStatus(Strophe.Status.CONNECTING,null);this._requests.push(new Strophe.Request(a.tree(),
this._onRequestStateChange.bind(this).prependArg(this._connect_cb.bind(this)),a.tree().getAttribute("rid")));this._throttledRequestHandler()},stropheConnectCb:function(a){a.getResponse()?this._original_connect_cb(a):this._changeConnectStatus(Strophe.Status.CONNFAIL,"unknown")},stropheSerialize:function(){var a="<body></body>";try{a=Strophe._originalSerialize.apply(Strophe,arguments)}catch(b){}return a},getLandDOMElement:function(a){if(a===undefined)a=Disney.Social.currentLand;if(a===undefined)return null;
return $("."+a.replace(/(:|\.)/g,"_")+"_player")[0]},setCurrentLand:function(a){if(a===undefined)delete Disney.Social.currentLand;else Disney.Social.currentLand=a;Disney.Social.Event.updateListeners(Disney.Social.Event.LAND_CHANGE,a)},getUrl:function(){var a=arguments.length,b,c;if((c=arguments[a-1])&&typeof c==="boolean"){c="";a--}else c="?v="+DISNEY_FRIENDS_INI.VERSION;if(a===1){a=Disney.Social.Environment.FRIENDS_BASE_URL+"/";b=arguments[0]}else{a=arguments[0];b=arguments[1]}return a+b+c},getUrlForLanguage:function(){return arguments.length===
1?this.getUrl(arguments[0].replace(/\{0\}/g,Disney.Social.pageLang)):this.getUrl(arguments[0],arguments[1].replace(/\{0\}/g,Disney.Social.pageLang))},getJavascriptSafeUrl:function(a){var b=location.protocol+"//"+location.hostname+":"+location.port;return b=b+a+"?v="+DISNEY_FRIENDS_INI.VERSION},getUrlVars:function(){for(var a=[],b,c=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),d=0;d<c.length;d++){b=c[d].split("=");a.push(b[0]);a[b[0]]=b[1]}return a},getUrlVar:function(a){return this.getUrlVars()[a]},
logDebug:function(){},log:function(a){typeof console!=="undefined"&&console.info(a)},logWarn:function(a){typeof console!=="undefined"&&console.warn(a)},logError:function(a){if(typeof console!=="undefined"){typeof console.trace==="function"&&console.trace();a?console.error("Error: ",a,a.name,a.message):console.error("Undefined error.")}},typeOf:function(a){var b=typeof a;if(b==="object")if(a){if(a instanceof Array)b="array"}else b="null";return b},isNumeric:function(a){return!isNaN(parseFloat(a))&&
isFinite(a)},isNumber:function(a){return typeof a==="number"&&isFinite(a)},isValidSwid:function(a){return a!==undefined&&a!==null&&a!==""},shortCircuit:function(a,b,c,d){if(d[a]===undefined){setTimeout(function(){var e=Array.prototype.slice.call(d,0);e.push(true);c.apply(b,e)},5);return true}return false},augmentTypes:function(){if(!Function.prototype.bind)Function.prototype.bind=function(a){return function(b){var c=this;if(1<arguments.length){var d=a.call(arguments,1);return function(){return c.apply(b,
arguments.length?d.concat(a.call(arguments)):d)}}return function(){return arguments.length?c.apply(b,arguments):c.call(b)}}}(Array.prototype.slice);if(typeof Object.create!="function")Object.create=function(a){function b(){}b.prototype=a;return new b};if(typeof Object.extend!=="function")Object.extend=function(a,b){for(var c in b)if(b.hasOwnProperty(c))a[c]=b[c];return a};if(typeof Object.include!=="function")Object.include=function(a){for(var b in a)if(a.hasOwnProperty(b))this[b]=a[b]};if(typeof Object.size!==
"function")Object.size=function(a){var b=0,c;for(c in a)a.hasOwnProperty(c)&&b++;return b}},stopEvent:function(a){a.cancelable&&a.preventDefault();a.cancelBubble=true;a.stopPropagation&&a.stopPropagation();Disney.Social.Event&&Disney.Social.Event.updateListeners(Disney.Social.Event.EVENT_STOPPED,a)},unbindAll:function(a){if(!a)return false;$(a).unbind().find("*").each(function(){$(this).unbind()})}};Disney.Social.init();Disney.Social.Environment={DEBUG_CONFIG:"false",DEBUG:false,FRIENDS_BASE_URL:"http://web.archive.org/web/20130109004621/http://media1.friends.go.com",CLUBPENGUIN_CONTENT_URL:"http://web.archive.org/web/20130109004621/http://media1.clubpenguin.com/play",BOSH_PATH:"/friends/bind",CLUB_PENGUIN_AVATAR_URL:"http://web.archive.org/web/20130109004621/http://cdn.avatar.clubpenguin.com",PRESENCE_LIMIT_CONFIG:"true",PRESENCE_LIMIT:false,PRESENCE_TIME_PERIOD:"60",REMOTE_LOGGING_ENABLED_CONFIG:"false",REMOTE_LOGGING_ENABLED:false,REMOTE_LOGGING_URL:"http://web.archive.org/web/20130109004621/http://logger.friends.go.com/logging-web-service/log",METRICS_ENABLED_CONFIG:"true",
METRICS_ENABLED:false,METRICS_URL:"http://web.archive.org/web/20130109004621/http://logger.friends.go.com/eventlogger-service-web/log_events",METRICS_BATCH_SIZE:"100",METRICS_BATCH_INTERVAL:"120000",METRICS_MAX_SIZE:"1000",DIMG_LOGGING_HOST:"log.data.disney.com",DIMG_LOGGING_APP_ID:"cpfriends",ROOMS_PATH:"/{0}/web_service/game_configs/rooms.jsonp",WORLDS_PATH:"/content/disney-land-clubpenguin/{0}/worlds.jsonp",CHARACTERS_PATH:"/content/disney-land-clubpenguin/{0}/characters.jsonp",MASCOTS_PATH:"/{0}/web_service/game_configs/mascots.jsonp",JUMP_STATUS_FOR_ROOMS_URL:"http://web.archive.org/web/20130109004621/http://jump.friends.go.com/jump_world",JUMP_STATUS_POLLING_INTERVAL:"60000",
LANDS_PATH:"/content/{0}/lands.jsonp",MARKUP_PATH:"/content/markup.jsonp",TEXT_PATH:"/content/{0}/text.jsonp",IMAGES_PATH:"/content/images.jsonp",BEST_FRIENDS_ENABLED_THRESHHOLD:10,init:function(){if(Disney.Social.getUrlVar("debug")!==undefined||this.DEBUG_CONFIG==="true")this.DEBUG=true;if(this.METRICS_ENABLED_CONFIG==="true")this.METRICS_ENABLED=true;if(this.PRESENCE_LIMIT_CONFIG==="true")this.PRESENCE_LIMIT=true;if(this.REMOTE_LOGGING_ENABLED_CONFIG==="true")this.REMOTE_LOGGING_ENABLED=true;Disney.Social.debugMode=this.DEBUG}};Disney.Social.Environment.init();Disney.Social.EventAbstract={addListener:function(a,b){if(!a||typeof a!=="string")return false;if(!b||typeof b!=="function")return false;this.listeners[a]||(this.listeners[a]=[]);this.listeners[a].indexOf(b)<0&&this.listeners[a].push(b)},removeListener:function(a,b){if(a&&b&&typeof a==="string"&&typeof b==="function"&&this.listeners[a]){var d=this.listeners[a].indexOf(b);d>=0&&this.listeners[a].splice(d,1)}},addGameListener:function(a,b){if(this.gameListeners[a]===undefined)this.gameListeners[a]=
[];$.inArray(b,this.gameListeners[a])<0&&this.gameListeners[a].push(b)},updateListeners:function(a){var b=Array.prototype.slice.call(arguments,1),d,c,e;if(!a||typeof a!=="string")return false;if(this.listeners[a]){d=this.listeners[a];e=d.length;for(c=0;c<e;c++)try{d[c].apply(null,b)}catch(f){}}if(this.gameListeners&&this.gameListeners[a]){d=[];e=b.length;for(c=0;c<e;c++)switch(Disney.Social.typeOf(b[c])){case "string":case "boolean":case "number":case "array":d.push(b[c]);break;default:b[c].tagName||
d.push(b[c])}for(b=0;b<this.gameListeners[a].length;b++){c=this.gameListeners[a][b];try{Disney.Social.getLandDOMElement(c).friendsEventHandler(a,d)}catch(g){}}}}};Disney.Social.Event={LAND_CHANGE:"landChange",ROOM_UPDATE:"roomUpdate",EVENT_STOPPED:"eventStopped",addListener:function(a,b){this.eventManager.addListener(a,b)},addGameListener:function(a,b){this.eventManager.addGameListener(a,b)},initEventManager:function(){this.eventManager=new Disney.Social.Event.Manager},updateListeners:function(){this.eventManager.updateListeners.apply(this.eventManager,Array.prototype.slice.call(arguments,0))}};
Disney.Social.Event.Manager=function(){this.listeners={};this.gameListeners={}};Disney.Social.Event.Manager.prototype=Disney.Social.EventAbstract;Disney.Social.Event.initEventManager();Disney.Social.API={setCurrentLand:function(a){Disney.Social.setCurrentLand(a)}};Disney.Social.RemoteLogging={LOGGING_QUEUE_CONTENT_SIZE:800,STROPHE_STANZA_LOGGING_QUEUE_MAX_SIZE:5,MAX_REQUESTS:3,LOG_MESSAGE_CHARACTER_SIZE:25,BODY_MAX_SIZE:130,loggingQueue:[],stropheStanzaLoggingQueue:[],stropheStanzaLoggingEnabled:true,logClientDetailsSent:false,swid:null,sessionDate:new Date,error:false,requests:0,disableStropheStanzaLogging:function(){this.stropheStanzaLoggingEnabled=false},logStropheStanza:function(a){if(this.stropheStanzaLoggingEnabled){a=a.replace(/xmlns[^=]*='[^']+'\s*/g,
"");this.log(Disney.Social.RemoteLogging.Code.STROPHE_STANZA,a)}},logClientDetails:function(){if(!this.logClientDetailsSent){var a=navigator.platform+"|";a+=navigator.appVersion+"|";a+=navigator.appName;this.log(Disney.Social.RemoteLogging.Code.CLIENT_DETAILS,a);this.logClientDetailsSent=true}},getLoggingQueueCharacterSize:function(){var a=0,b;for(b in this.loggingQueue){var c=this.loggingQueue[b];a+=this.LOG_MESSAGE_CHARACTER_SIZE;if(c.b)a+=6+c.b.length}return a},log:function(a,b){if(!Disney.Social.Environment.REMOTE_LOGGING_ENABLED)return true;
if(this.requests>=this.MAX_REQUESTS)return true;if(b!==undefined&&b!==null)b=b.substr(0,this.BODY_MAX_SIZE);var c={d:(new Date).getTime()-this.sessionDate.getTime(),c:a,b:b};if(a===Disney.Social.RemoteLogging.Code.STROPHE_STANZA)for(this.stropheStanzaLoggingQueue.push(c);this.stropheStanzaLoggingQueue.length>this.STROPHE_STANZA_LOGGING_QUEUE_MAX_SIZE;)this.stropheStanzaLoggingQueue.shift();else for(this.loggingQueue.push(c);this.getLoggingQueueCharacterSize()>this.LOGGING_QUEUE_CONTENT_SIZE;)this.loggingQueue.shift();
if(a.lastIndexOf("e")===a.length-1){this.error=true;setTimeout(function(){this.sendLogMessages(false)}.bind(this),5E3)}},sendLogMessages:function(a){var b=Disney.Social.Environment;if(!b.REMOTE_LOGGING_ENABLED)return true;if(this.loggingQueue.length+this.stropheStanzaLoggingQueue.length===0||!this.error)return true;if(!a&&this.swid===null)return true;this.logClientDetails();a=this.swid;if(a===undefined||a===null||a.length===0)a="{undefined}";var c=JSON.stringify(this.loggingQueue.concat(this.stropheStanzaLoggingQueue));
b=b.REMOTE_LOGGING_URL+"?s="+a+"&d="+this.sessionDate.getTime()+"&r="+c;a=new Image;a.onload=function(){this.onload=null};a.src=b+"&v="+(new Date).getTime();this.requests++;this.loggingQueue.length=0;this.stropheStanzaLoggingQueue.length=0;this.error=false}};
Disney.Social.RemoteLogging.Code={STROPHE_STANZA:"01i",STROPHE_WARN:"02w",STROPHE_ERROR:"02e",CLIENT_DETAILS:"03i",CHARACTER_DATA_REQUEST:"04r",CHARACTER_DATA_SUCCESS:"04s",LAND_DATA_REQUEST:"05r",LAND_DATA_SUCCESS:"05s",WORLD_DATA_REQUEST:"06r",WORLD_DATA_SUCCESS:"06s",ROOM_DATA_REQUEST:"07r",ROOM_DATA_SUCCESS:"07s",MASCOT_DATA_REQUEST:"08r",MASCOT_DATA_SUCCESS:"08s",MARKUP_DATA_REQUEST:"09r",MARKUP_DATA_SUCCESS:"09s",TEXT_DATA_REQUEST:"10r",TEXT_DATA_SUCCESS:"10s",IMAGE_DATA_REQUEST:"11r",IMAGE_DATA_SUCCESS:"11s",
EMPTY_SWID_ERROR:"12e",EMPTY_PASSWORD_ERROR:"13e",FLASH_CRASHED:"14e",FLASH_ERROR:"15e",FLASH_INFO:"15i",FLASH_WARN:"15w",FLASH_FPS_WARN:"16w",MOBILE_DATA_REQUEST:"17r",MOBILE_DATA_SUCCESS:"17s"};Disney.Social.Data={lands:{},worlds:{},rooms:{},characters:{},mascots:{},init:function(){var d=Disney.Social,b=d.Environment,a=Disney.Social.RemoteLogging;a.log(a.Code.CHARACTER_DATA_REQUEST);$.ajax(d.getUrlForLanguage(b.FRIENDS_BASE_URL,b.CHARACTERS_PATH),{cache:true,dataType:"jsonp",jsonpCallback:"charactersData",success:function(c){Disney.Social.Data.characters=c;a.log(a.Code.CHARACTER_DATA_SUCCESS)}});a.log(a.Code.LAND_DATA_REQUEST);$.ajax(d.getUrlForLanguage(b.FRIENDS_BASE_URL,b.LANDS_PATH),
{cache:true,dataType:"jsonp",jsonpCallback:"landsData",success:function(c){Disney.Social.Data.lands=c;a.log(a.Code.LAND_DATA_SUCCESS)}});a.log(a.Code.WORLD_DATA_REQUEST);$.ajax(d.getUrlForLanguage(b.FRIENDS_BASE_URL,b.WORLDS_PATH),{cache:true,dataType:"jsonp",jsonpCallback:"worldsData",success:function(c){Disney.Social.Data.worlds=c;a.log(a.Code.WORLD_DATA_SUCCESS)}});a.log(a.Code.ROOM_DATA_REQUEST);$.ajax(d.getUrlForLanguage(b.CLUBPENGUIN_CONTENT_URL,b.ROOMS_PATH),{cache:true,dataType:"jsonp",jsonpCallback:"cp_rooms",
success:function(c){Disney.Social.Data.rooms=c;a.log(a.Code.ROOM_DATA_SUCCESS)}});a.log(a.Code.MASCOT_DATA_REQUEST);$.ajax(d.getUrlForLanguage(b.CLUBPENGUIN_CONTENT_URL,b.MASCOTS_PATH),{cache:true,dataType:"jsonp",jsonpCallback:"cp_mascots",success:function(c){Disney.Social.Data.mascots=c;a.log(a.Code.MASCOT_DATA_SUCCESS)}})}};Disney.Social.Data.init();Disney.ClubPenguin={MARGIN:6,GAME_WIDTH:760,GAME_HEIGHT:480,GAME_ASPECT_RATIO:760/480,BUDDY_ICON_POSITION_X:575,BUDDY_ICON_POSITION_Y:445,getNotifyPosition:function(){var a=$("#D_F_GameSection"),d=a.width(),e=a.height(),b=0,c=0;if(d/e>this.GAME_ASPECT_RATIO){b=e;c=b*this.GAME_ASPECT_RATIO}else{c=d;b=c/this.GAME_ASPECT_RATIO}var f=b*this.BUDDY_ICON_POSITION_Y/this.GAME_HEIGHT,g=c*this.BUDDY_ICON_POSITION_X/this.GAME_WIDTH;a=a.offset();return{left:a.left+(d-c)/2+g,top:a.top+(e-b)/2+f}}};Disney.Friends={PRESENCE_DOMAIN:"d",createJidFromSwid:function(a){return a+"@"+this.PRESENCE_DOMAIN},activeConnection:null,activeUser:null};Disney.Friends.Data={};Disney.Friends.Data.RosterItem={swid:"",name:"",weight:0,canJumpTo:false,groups:[],presence:{}};Disney.Friends.Data.Presence={status:{},resources:{},id:"",location:{}};Disney.Friends.Data.LandPresence={ns:"",id:0,location:{}};Disney.Friends.StanzaConstants={XMLNS:"xmlns",JID:"jid",ID:"id",FROM:"from",IQ:"iq",IQ_GET:"get",IQ_SET:"set",IQ_TYPE_ERROR:"error",IQ_TYPE_RESULT:"result",IQ_QUERY:"query",IQ_ITEM:"item",IQ_CHARACTER:"character",IQ_NAME:"name",LAND:"land",STANZA_TYPE:"type",PRESENCE:"presence",SUBSCRIPTION:"subscription",SUBSCRIPTION_REMOVE:"remove",SUBSCRIPTION_BOTH:"both",IGNORE_ITEM:"item",IGNORE_JID:"jid",IGNORE_REMOVE:"remove",PRESENCE_TYPE_ERROR:"error",PRESENCE_TYPE_SUBSCRIBE:"subscribe",PRESENCE_TYPE_SUBSCRIBED:"subscribed",
PRESENCE_TYPE_UNSUBSCRIBED:"unsubscribed",PRESENCE_TYPE_UNAVAILABLE:"unavailable",SETTING_ITEM:"setting",SETTING_NAME:"name",SETTING_VALUE:"value",SETTING_REMOVE:"remove",WEIGHT:"weight",MESSAGE:"message"};Disney.Analysis={analysisUrl:"http://"+Disney.Social.Environment.DIMG_LOGGING_HOST+"/cp",logEvent:function(a){a=this.analysisUrl+"?"+a.serialize();(new Image).src=a},pageViewEvent:function(a){this.logEvent(new Disney.Analysis.Event.PageView(Disney.Friends.API.getSwid(),"/friends/"+a))},timingEvent:function(a,b){this.logEvent(new Disney.Analysis.Event.Timing(Disney.Friends.API.getSwid(),a,b))},gameActionEvent:function(a,b){this.logEvent(new Disney.Analysis.Event.GameAction(Disney.Friends.API.getSwid(),
a,b))},loggingEvent:function(a,b){Disney.Metrics.fireMetric(a,b);b!==undefined?this.pageViewEvent(a+"/"+b):this.pageViewEvent(a)},logTheJump:function(a,b){var c=b.location.world,d=b.location.room;this.pageViewEvent(Disney.Metrics.Type.JUMP_PERFORMED+"/"+a+"/"+c+"/"+d);Disney.Metrics.fireMetric(Disney.Metrics.Type.JUMP_PERFORMED,a+"|"+c+"|"+d)}};Disney.Analysis.Locale={en:"en_US",fr:"fr_FR",pt:"pt_BR",es:"es_ES",de:"de_DE"};Disney.Analysis.Event=function(a,b){arguments.length>0&&this.init(a,b)};Disney.Analysis.Event.prototype={init:function(a,b){this.app=Disney.Social.Environment.DIMG_LOGGING_APP_ID;this.view_network=this.network="c";if(a.length===2)a=Disney.Analysis.Locale[a];this.app_locale=a;this.tag=b},serialize:function(){var a="",b;for(b in this)if(this.hasOwnProperty(b))if(typeof this[b]!=="function"&&typeof this[b]!=="object"){if(a!=="")a+="&";a+=b+"="+this[b]}return a}};Disney.Analysis.Event.Timing=function(c,a,b){arguments.length>0&&this.init(c,a,b)};Disney.Analysis.Event.Timing.prototype=new Disney.Analysis.Event;Disney.Analysis.Event.Timing.constructor=Disney.Analysis.Event.Timing;Disney.Analysis.Event.Timing.superclass=Disney.Analysis.Event.prototype;
Disney.Analysis.Event.Timing.prototype.init=function(c,a,b){Disney.Analysis.Event.Timing.superclass.init.call(this,Disney.Social.pageLang,"timing");this.user_id=c;if(a!==null)this.location=a;if(b!==undefined)this.elapsed_time=b};Disney.Analysis.Event.PageView=function(a,b){arguments.length>0&&this.init(a,b)};Disney.Analysis.Event.PageView.prototype=new Disney.Analysis.Event;Disney.Analysis.Event.PageView.constructor=Disney.Analysis.Event.PageView;Disney.Analysis.Event.PageView.superclass=Disney.Analysis.Event.prototype;Disney.Analysis.Event.PageView.prototype.init=function(a,b){Disney.Analysis.Event.PageView.superclass.init.call(this,Disney.Social.pageLang,"pageview");this.user_id=a;this.location=b};Disney.Analysis.Event.GameAction=function(b,c,a){arguments.length>0&&this.init(b,c,a)};Disney.Analysis.Event.GameAction.prototype=new Disney.Analysis.Event;Disney.Analysis.Event.GameAction.constructor=Disney.Analysis.Event.GameAction;Disney.Analysis.Event.GameAction.superclass=Disney.Analysis.Event.prototype;
Disney.Analysis.Event.GameAction.prototype.init=function(b,c,a){Disney.Analysis.Event.GameAction.superclass.init.call(this,Disney.Social.pageLang,"game_action");this.user_id=b;this.context=c;this.action=a!==null?a:""};Disney.Friends.Event={USER_PRESENCE_UPDATE:"userPresenceUpdate",FRIENDS_NEW:"friendsNew",FRIENDS_UPDATE:"friendsUpdate",FRIENDS_GOT_SETTINGS:"friendsGotSettings",FRIENDS_WEIGHT_UPDATE:"friendsWeightUpdate",FRIENDS_REMOVE:"friendsRemove",PENDING_UPDATE:"pendingUpdate",PENDING_REMOVE:"pendingRemove",HUD_UPDATE:"hudUpdate",SHOWING_NOTIFICATION:"showingNotification",CLOSED_NOTIFICATION:"closedNotification",CHARACTER_INVITE:"characterInvite",IGNORED_UPDATE:"ignoredUpdate",FRIENDS_JUMP:"friendsJump",FRIENDS_JUMP_AVAILABLE:"friendsJumpAvailable",
FRIENDS_JUMP_FAILED:"friendsJumpFailed",JUMP_STATUS_FOR_ROOMS_UPDATE:"jumpStatusForRoomsUpdate",SHOW_PLAYER_CARD:"showPlayerCard",SHOW_CHARACTER_CARD:"showCharacterCard",DISCONNECTED:"disconnected",CONNECTED:"connected",FIND_PLAYER:"findPlayer",FOUND_PLAYER:"foundPlayer",FIND_PLAYER_NOT_FOUND:"findPlayerNotFound",FIND_PLAYER_EXISTING_FRIEND:"findPlayerExistingFriend",FIND_PLAYER_EXISTING_IGNORE:"findPlayerExistingIgnore",SAFE_CHAT_CONNECTION_UPDATE:"safeChatConnectionUpdate",RECEIVED_SNOWBALL:"receivedSnowball",
addListener:function(a,b){this.eventManager.addListener(a,b)},addGameListener:function(a,b){this.eventManager.addGameListener(a,b)},initEventManager:function(){this.eventManager=new Disney.Friends.Event.Manager},updateListeners:function(){this.eventManager.updateListeners.apply(this.eventManager,Array.prototype.slice.call(arguments,0))}};Disney.Friends.Event.Manager=function(){this.listeners={};this.gameListeners={}};Disney.Friends.Event.Manager.prototype=Disney.Social.EventAbstract;Disney.Friends.Event.initEventManager();Disney.Friends.Event.Warning={FRIENDS_LIMIT:"friendsLimit",IGNORED_LIMIT:"ignoreLimit",BEST_FRIENDS_LIMIT:"bestFriendsLimit"};Disney.Friends.API={getFriends:function(){return Disney.Friends.activeUser.getRoster().getFriends()},getOnlineFriends:function(){return Disney.Friends.activeUser.getRoster().getOnlineFriends()},getIgnored:function(){return Disney.Friends.activeUser.getRoster().getIgnored()},connect:function(a,c){if(!Disney.Social.shortCircuit(2,this,arguments.callee,arguments)){if(Disney.Friends.activeConnection===undefined||Disney.Friends.activeConnection===null){Disney.Friends.activeConnection=new Disney.Friends.Connection(Disney.Social.getJavascriptSafeUrl(Disney.Social.Environment.BOSH_PATH));
Disney.Friends.activeConnection.swid=a;Disney.Friends.activeConnection.password=c}Disney.Friends.activeConnection.connectionStatus===Strophe.Status.DISCONNECTED&&Disney.Friends.activeConnection.connect()}},isConnected:function(){if(Disney.Friends.activeConnection!==undefined&&Disney.Friends.activeConnection!==null&&Disney.Friends.activeConnection.connectionStatus===Strophe.Status.CONNECTED)return true;return false},getSwid:function(){var a=null;if(Disney.Friends.activeConnection!==undefined&&Disney.Friends.activeConnection!==
null)a=Disney.Friends.activeConnection.swid;return a},disconnect:function(a){if(!Disney.Social.shortCircuit(1,this,arguments.callee,arguments))if(Disney.Friends.activeConnection){Disney.Friends.activeConnection.disconnect(a);a==="gameTimeout"&&this.toggle(0)}},toggle:function(a){if(a===undefined||a===null)Disney.Friends.UI.toggleFriendsSection();else a?Disney.Friends.UI.showFriendsSection():Disney.Friends.UI.hideFriendsSection()},updateFriend:function(a){Disney.Friends.activeUser.roster.updateFriend(a)},
updatePresence:function(a){if(!Disney.Social.shortCircuit(1,this,arguments.callee,arguments)){var c=(new Strophe.Builder("land",{xmlns:a.location.land})).c("id").t(a.id.toString()).up(),b;for(b in a.location)a.location.hasOwnProperty(b)&&b!=="land"&&Disney.Social.isNumeric(a.location[b].toString())&&c.c(b).t(a.location[b].toString()).up();Disney.Friends.activeUser&&Disney.Friends.activeUser.setLandPresence(c.tree())}},connectedToSafeChat:function(){return Disney.Friends.activeUser.connectedToSafeChat},
jumpToFriend:function(a){return this.jump(a,Disney.Friends.Jump.MAKE_RESERVATION_AND_DO_THE_JUMP)},jumpToCharacter:function(a){if(a!==undefined&&a.id!==undefined&&a.location!==undefined){Disney.Friends.Event.updateListeners(Disney.Friends.Event.FRIENDS_JUMP,{id:a.id,location:a.location,type:Disney.Friends.Jump.DO_THE_JUMP});Disney.Analysis.logTheJump(a.id,a)}},jump:function(a,c){var b=this.getFriends();if(b[a]!==undefined&&b[a].presence!==undefined&&b[a].presence.id!==undefined){Disney.Friends.Event.updateListeners(Disney.Friends.Event.FRIENDS_JUMP,
{id:b[a].presence.id,location:b[a].presence.location,swid:a,type:c});Disney.Analysis.logTheJump(a,b[a].presence);return true}return false},jumpFailure:function(a){if(!Disney.Social.shortCircuit(1,this,arguments.callee,arguments)){Disney.Friends.Jump.pendingJump=a;Disney.Friends.Event.updateListeners(Disney.Friends.Event.FRIENDS_JUMP_FAILED,a)}},reservationReady:function(a){if(!Disney.Social.shortCircuit(1,this,arguments.callee,arguments))if(a===Disney.Friends.Jump.pendingJump){Disney.Friends.Event.updateListeners(Disney.Friends.Event.FRIENDS_JUMP_AVAILABLE,
a);Disney.Friends.Jump.pendingJump=null}},pollJumpStatus:function(a){Disney.Friends.Jump.pollJumpStatus(a)},getJumpStatus:function(a){Disney.Friends.Jump.getJumpStatus(a)},findPlayerByName:function(a){Disney.Friends.Event.updateListeners(Disney.Friends.Event.FIND_PLAYER,a)},foundPlayer:function(a){if(a.playerId>0)if(Disney.Friends.activeUser.roster.findFriend(a.swid)!==undefined)Disney.Friends.Event.updateListeners(Disney.Friends.Event.FIND_PLAYER_EXISTING_FRIEND,a.name);else Disney.Friends.activeUser.roster.findIgnore(a.swid)!==
undefined?Disney.Friends.Event.updateListeners(Disney.Friends.Event.FIND_PLAYER_EXISTING_IGNORE,a.name):Disney.Friends.Event.updateListeners(Disney.Friends.Event.FOUND_PLAYER,a);else Disney.Friends.Event.updateListeners(Disney.Friends.Event.FIND_PLAYER_NOT_FOUND,a.name)},requestFriendship:function(a){Disney.Social.shortCircuit(1,this,arguments.callee,arguments)||Disney.Social.isValidSwid(a)&&Disney.Friends.activeUser.roster.requestFriendship(a)},acceptFriendship:function(a){Disney.Social.shortCircuit(1,
this,arguments.callee,arguments)||Disney.Social.isValidSwid(a)&&Disney.Friends.activeUser.roster.acceptFriendship(a)},rejectFriendship:function(a){Disney.Social.shortCircuit(1,this,arguments.callee,arguments)||Disney.Social.isValidSwid(a)&&Disney.Friends.activeUser.roster.rejectFriendship(a)},removeFriendship:function(a){Disney.Social.shortCircuit(1,this,arguments.callee,arguments)||Disney.Social.isValidSwid(a)&&Disney.Friends.activeUser.roster.removeFriendship(a)},addCharacter:function(a){Disney.Social.shortCircuit(1,
this,arguments.callee,arguments)||Disney.Friends.activeUser.roster.addCharacter(a)},removeCharacter:function(a){Disney.Social.shortCircuit(1,this,arguments.callee,arguments)||Disney.Friends.activeUser.roster.removeCharacter(a)},addIgnored:function(a){Disney.Social.shortCircuit(1,this,arguments.callee,arguments)||Disney.Social.isValidSwid(a)&&Disney.Friends.activeUser.roster.addIgnored(a)},removeIgnored:function(a){Disney.Social.shortCircuit(1,this,arguments.callee,arguments)||Disney.Social.isValidSwid(a)&&
Disney.Friends.activeUser.roster.removeIgnored(a)},showPlayerCard:function(a){var c=Disney.Friends.activeUser.roster.findGuest(a),b=null;if(c!==undefined&&c.presence!==undefined&&c.presence.location!==undefined)b=c.presence.location.land;else if(c!==undefined)b="disney:land:clubpenguin";if(Disney.Social.currentLand===b){Disney.Friends.Event.updateListeners(Disney.Friends.Event.SHOW_PLAYER_CARD,a);Disney.Analysis.loggingEvent(Disney.Metrics.Type.PLAYER_CARD_REQUESTED,a)}},showCharacterCard:function(a){if(Disney.Friends.activeUser.roster.findGuest(a)){Disney.Friends.Event.updateListeners(Disney.Friends.Event.SHOW_CHARACTER_CARD,
a);Disney.Analysis.loggingEvent(Disney.Metrics.Type.CHARACTER_CARD_REQUESTED,a)}},showingNotification:function(){Disney.Friends.Event.updateListeners(Disney.Friends.Event.SHOWING_NOTIFICATION)},closedNotification:function(){Disney.Friends.Event.updateListeners(Disney.Friends.Event.CLOSED_NOTIFICATION)},addInteraction:function(a,c){Disney.Social.shortCircuit(2,this,arguments.callee,arguments)||Disney.Social.isValidSwid(a)&&Disney.Friends.activeUser.roster.addInteraction(a,c)},hudVisibilityChanged:function(a){if(!Disney.Social.shortCircuit(1,
this,arguments.callee,arguments)){typeof this.currentHudVisibilityTimeout==="number"&&clearTimeout(this.currentHudVisibilityTimeout);if(a)this.currentHudVisibilityTimeout=setTimeout(function(){Disney.Friends.Event.updateListeners(Disney.Friends.Event.HUD_UPDATE,a)},500);else Disney.Friends.Event.updateListeners(Disney.Friends.Event.HUD_UPDATE,a)}},respondToSnowballs:function(a,c){if(!Disney.Social.shortCircuit(1,this,arguments.callee,arguments)){var b=Disney.Friends.activeUser.getRoster();if(a!==
null&&a.length>0)for(i in a)return b.respondToSnowball(a[i],true);if(c!==null&&c.length>0)for(i in c)return b.respondToSnowball(c[i],false)}}};Disney.Friends.User=function(a){this.connection=a;this.settings=this.roster=null;this.lastPresenceSent=0;this.presence=$pres().tree();Disney.Social.Event.addListener(Disney.Social.Event.LAND_CHANGE,this.landChange.bind(this))};
Disney.Friends.User.prototype={getRoster:function(){return this.roster},setRoster:function(a){this.roster=a},getSettings:function(){return this.settings},setSettings:function(a){this.settings=a},setLandPresence:function(a){var b=$(this.presence),e=b.find("world").text(),d=Disney.Social.Data.worlds[e];if(d===undefined)d={};b.find("land").remove();a!==undefined&&a!==null&&b.append(a);a=b.find("world").text();var c=Disney.Social.Data.worlds[a];if(c===undefined)c={};a!==e&&c.is_safe!==d.is_safe&&Disney.Friends.Event.updateListeners(Disney.Friends.Event.SAFE_CHAT_CONNECTION_UPDATE,
c.is_safe);Disney.Friends.Event.updateListeners(Disney.Friends.Event.USER_PRESENCE_UPDATE,b.clone().get(0));b.find("room")!==undefined&&this.sendPresence()},sendPresence:function(){if(Disney.Social.Environment.PRESENCE_LIMIT){var a=(new Date).getTime()/1E3,b=a-this.lastPresenceSent;if(b<Disney.Social.Environment.PRESENCE_TIME_PERIOD){if(!this.presenceSendTimeout)this.presenceSendTimeout=setTimeout(this.sendPresence.bind(this),(Disney.Social.Environment.PRESENCE_TIME_PERIOD-b)*1E3)}else{if(typeof this.presenceSendTimeout===
"number"){clearTimeout(this.presenceSendTimeout);delete this.presenceSendTimeout}this.connection.send(this.presence);this.lastPresenceSent=a}}else this.connection.send(this.presence)},sendOfflinePresence:function(){this.connection.send($pres({type:"unavailable"}))},getPresence:function(){return this.presence},landChange:function(a){var b;if(a!==undefined)b=new Strophe.Builder("land",{xmlns:a});this.setLandPresence(b!==undefined?b.tree():b)}};Disney.Friends.Roster=function(a,b){this.connection=a;this.user=b;this.friends={};this.pending={};this.ignored={};this.snowballReceipts={};Strophe.addNamespace("IGNORE","disney:friends:ignore");Strophe.addNamespace("CHARACTER_ROSTER","disney:friends:character:roster");Strophe.addNamespace("CHARACTER_PRESENCE","disney:friends:character:presence");Strophe.addNamespace("ORDERING_PRIORITY","disney:ordering:priority");this.connection.addHandler(this.rosterUpdateHandler.bind(this),Strophe.NS.ROSTER,Disney.Friends.StanzaConstants.IQ,
Disney.Friends.StanzaConstants.IQ_SET);this.connection.addHandler(this.characterRosterUpdateHandler.bind(this),Strophe.NS.CHARACTER_ROSTER,Disney.Friends.StanzaConstants.IQ,Disney.Friends.StanzaConstants.IQ_SET);this.connection.addHandler(this.ignoreUpdateHandler.bind(this),Strophe.NS.IGNORE,Disney.Friends.StanzaConstants.IQ,Disney.Friends.StanzaConstants.IQ_SET);this.connection.addHandler(this.presenceHandler.bind(this),null,Disney.Friends.StanzaConstants.PRESENCE);this.connection.addHandler(this.snowballHandler.bind(this),
null,Disney.Friends.StanzaConstants.MESSAGE)};
Disney.Friends.Roster.prototype={initialStanzas:function(){this.sendRosterRequest();this.sendIgnoredRequest()},getFriends:function(){return this.friends},findGuest:function(a){var b=this.findFriend(a);if(b===undefined){b=this.findPending(a);if(b===undefined)b=this.findIgnore(a)}return b},findFriend:function(a){return this.friends[a]},findIgnore:function(a){return this.ignored[a]},findPending:function(a){return this.pending[a]},getOnlineFriends:function(){var a={},b;for(b in this.friends){var c=this.friends[b];
if(c.presence.status!==undefined&&c.presence.status!==Disney.Friends.Presence.Status.OFFLINE)a[b]=c}return a},getIgnored:function(){return this.ignored},getPending:function(){return this.pending},requestFriendship:function(a){this.friends[a]===undefined&&this.connection.send($pres({to:Disney.Friends.createJidFromSwid(a),type:Disney.Friends.StanzaConstants.PRESENCE_TYPE_SUBSCRIBE}))},acceptFriendship:function(a){this.connection.send($pres({to:Disney.Friends.createJidFromSwid(a),type:Disney.Friends.StanzaConstants.PRESENCE_TYPE_SUBSCRIBED}));
delete this.pending[a];Disney.Friends.Event.updateListeners(Disney.Friends.Event.PENDING_REMOVE,a)},rejectFriendship:function(a){this.connection.send($pres({to:Disney.Friends.createJidFromSwid(a),type:Disney.Friends.StanzaConstants.PRESENCE_TYPE_UNSUBSCRIBED}));delete this.pending[a];Disney.Friends.Event.updateListeners(Disney.Friends.Event.PENDING_REMOVE,a)},updateFriend:function(a){var b,c,d=Disney.Friends.StanzaConstants;b=$.extend({},this.friends[a.swid],a);c=$iq({type:d.IQ_SET,id:this.connection.getUniqueId()});
a.type==="c"?c.c(d.IQ_QUERY,{xmlns:Strophe.NS.CHARACTER_ROSTER}).c(d.IQ_CHARACTER,{id:b.swid}):c.c(d.IQ_QUERY,{xmlns:Strophe.NS.ROSTER}).c(d.IQ_ITEM,{jid:Disney.Friends.createJidFromSwid(b.swid)});$.each(b.groups,function(){c.c("group").t(String(this)).up()});this.connection.send(c)},removeFriendship:function(a){if(this.friends[a]!==undefined){var b=this.connection.getUniqueId();this.connection.send($iq({type:Disney.Friends.StanzaConstants.IQ_SET,id:b}).c(Disney.Friends.StanzaConstants.IQ_QUERY,{xmlns:Strophe.NS.ROSTER}).c(Disney.Friends.StanzaConstants.IQ_ITEM,
{jid:Disney.Friends.createJidFromSwid(a),subscription:Disney.Friends.StanzaConstants.SUBSCRIPTION_REMOVE}))}},addCharacter:function(a){this.friends[a]||this.connection.send($iq({type:Disney.Friends.StanzaConstants.IQ_SET}).c(Disney.Friends.StanzaConstants.IQ_QUERY,{xmlns:Strophe.NS.CHARACTER_ROSTER}).c(Disney.Friends.StanzaConstants.IQ_CHARACTER,{id:a}))},removeCharacter:function(a){this.friends[a]!==undefined&&this.connection.send($iq({type:Disney.Friends.StanzaConstants.IQ_SET,id:this.connection.getUniqueId()}).c(Disney.Friends.StanzaConstants.IQ_QUERY,
{xmlns:Strophe.NS.CHARACTER_ROSTER}).c(Disney.Friends.StanzaConstants.IQ_CHARACTER,{id:a,subscription:Disney.Friends.StanzaConstants.SUBSCRIPTION_REMOVE}))},addIgnored:function(a){if(this.ignored[a]===undefined){var b=this.connection.getUniqueId();a=$iq({type:Disney.Friends.StanzaConstants.IQ_SET,id:b}).c(Disney.Friends.StanzaConstants.IQ_QUERY,{xmlns:Strophe.NS.IGNORE}).c(Disney.Friends.StanzaConstants.IGNORE_ITEM,{jid:Disney.Friends.createJidFromSwid(a)});this.connection.addHandler(this.addIgnoredResultHandler.bind(this),
null,Disney.Friends.StanzaConstants.IQ,null,b);this.connection.send(a)}},addIgnoredResultHandler:function(a){$(a).attr(Disney.Friends.StanzaConstants.STANZA_TYPE)===Disney.Friends.StanzaConstants.IQ_TYPE_ERROR&&$(a).find("error").attr("code")==="7"&&Disney.Friends.Event.updateListeners(Disney.Friends.Event.Warning.IGNORED_LIMIT);return false},removeIgnored:function(a){var b=this.connection.getUniqueId();this.connection.send($iq({type:Disney.Friends.StanzaConstants.IQ_SET,id:b}).c(Disney.Friends.StanzaConstants.IQ_QUERY,
{xmlns:Strophe.NS.IGNORE}).c(Disney.Friends.StanzaConstants.IGNORE_ITEM,{jid:Disney.Friends.createJidFromSwid(a),remove:"true"}))},populateRoster:function(a){if($(a).attr(Disney.Friends.StanzaConstants.STANZA_TYPE)===Disney.Friends.StanzaConstants.IQ_TYPE_ERROR){Disney.Social.logError("Error trying to get initial roster list");return false}(new Date).getTime();var b=this;$(a).find("query item").each(function(c,d){b.updateFriendItem(d,true)});Object.size(this.friends)>=Disney.Social.Environment.BEST_FRIENDS_ENABLED_THRESHHOLD&&
!this.user.getSettings().getSetting(Disney.Friends.Settings.Constants.BEST_FRIEND_ENABLED)&&this.user.getSettings().addSetting(Disney.Friends.Settings.Constants.BEST_FRIEND_ENABLED,"true");(new Date).getTime();Object.size(this.ignored);Object.size(this.pending);(new Date).getTime();Disney.Friends.Event.updateListeners(Disney.Friends.Event.FRIENDS_UPDATE,this.friends);(new Date).getTime();this.sendOrderingPriorityRequest();this.sendCharacterRosterRequest();this.user.sendPresence();return false},populateCharacterRoster:function(a){if($(a).attr(Disney.Friends.StanzaConstants.STANZA_TYPE)==
Disney.Friends.StanzaConstants.IQ_TYPE_ERROR){Disney.Social.logError("Error trying to get initial character roster list");return false}var b=this;$(a).find("query character").each(function(c,d){b.addCharacterItem(d)});Disney.Friends.Event.updateListeners(Disney.Friends.Event.FRIENDS_UPDATE,this.friends);return false},populateOrderPriority:function(a){var b=this;$(a).find("query item").each(function(c,d){var f=$(d).attr("id");if(b.friends[f]!==undefined)b.friends[f].weight=parseInt($(d).attr(Disney.Friends.StanzaConstants.WEIGHT),
10)});Disney.Friends.Event.updateListeners(Disney.Friends.Event.FRIENDS_WEIGHT_UPDATE,this.friends)},populateIgnored:function(a){if($(a).attr(Disney.Friends.StanzaConstants.STANZA_TYPE)==Disney.Friends.StanzaConstants.IQ_TYPE_ERROR){Disney.Social.logError("Error trying to populate ignored list. Unable to get list from server.");return false}var b=this;a=$(a).find("query item");this.ignored={};a.length>0&&a.each(function(c,d){b.updateIgnoredItem(d)});Disney.Friends.Event.updateListeners(Disney.Friends.Event.IGNORED_UPDATE,
this.ignored);return false},rosterUpdateHandler:function(a){this.connection.sendIQResult(a);a=$(a).find("query item");if(a.attr("ask")!==Disney.Friends.StanzaConstants.PRESENCE_TYPE_SUBSCRIBE)a.attr(Disney.Friends.StanzaConstants.SUBSCRIPTION)===Disney.Friends.StanzaConstants.SUBSCRIPTION_REMOVE?this.removeFriendItem(a):this.updateFriendItem(a);return true},characterRosterUpdateHandler:function(a){this.connection.sendIQResult(a);a=$(a).find("query character");if(a.attr(Disney.Friends.StanzaConstants.SUBSCRIPTION)===
Disney.Friends.StanzaConstants.SUBSCRIPTION_REMOVE){a=this.removeCharacterItem(a);Disney.Friends.Event.updateListeners(Disney.Friends.Event.FRIENDS_REMOVE,a)}else{a=this.addCharacterItem(a);Disney.Friends.Event.updateListeners(Disney.Friends.Event.FRIENDS_UPDATE,a)}return true},ignoreUpdateHandler:function(a){var b=this;a=$(a).find("query item");a.length>0&&a.each(function(c,d){b.updateIgnoredItem(d)});Disney.Friends.Event.updateListeners(Disney.Friends.Event.IGNORED_UPDATE,this.ignored);return true},
presenceHandler:function(a){a=$(a);if(a.attr(Disney.Friends.StanzaConstants.XMLNS)===Strophe.NS.CHARACTER_PRESENCE){this.characterPresenceHandler(a);return true}var b=a.attr(Disney.Friends.StanzaConstants.STANZA_TYPE),c=a.attr(Disney.Friends.StanzaConstants.FROM),d=Strophe.getNodeFromJid(c);c=Strophe.getResourceFromJid(c);if(b===Disney.Friends.StanzaConstants.PRESENCE_TYPE_SUBSCRIBE){a=this.addPendingItem(a);Disney.Friends.Event.updateListeners(Disney.Friends.Event.PENDING_UPDATE,a)}else if(b===Disney.Friends.StanzaConstants.PRESENCE_TYPE_UNAVAILABLE)this.friendOffline(d,
c);else if(b===undefined)this.friendOnline(d,c,a);else b===Disney.Friends.StanzaConstants.PRESENCE_TYPE_ERROR&&$(a.children("error")[0]).attr("code")==="1"&&Disney.Friends.Event.updateListeners(Disney.Friends.Event.Warning.FRIENDS_LIMIT,d);return true},characterPresenceHandler:function(a){a=$(a);var b=a.attr(Disney.Friends.StanzaConstants.STANZA_TYPE),c=a.find("characterId").text();b===Disney.Friends.StanzaConstants.PRESENCE_TYPE_UNAVAILABLE?this.characterOffline(c):this.characterOnline(c,a);return true},
snowballHandler:function(a){a=$(a);var b=a.attr(Disney.Friends.StanzaConstants.ID),c=a.attr(Disney.Friends.StanzaConstants.FROM);a=$(a.children("snowball")[0]).attr(Disney.Friends.StanzaConstants.XMLNS);c=Strophe.getNodeFromJid(c);if("disney:mobile:snowball"===a){this.snowballReceipts[c]=b;Disney.Friends.Event.updateListeners(Disney.Friends.Event.RECEIVED_SNOWBALL,c)}return true},respondToSnowball:function(a,b){var c=this.snowballReceipts[a];this.connection.send((new Strophe.Builder("message",{xmlns:"jabber:client",
from:Disney.Friends.createJidFromSwid(Disney.Friends.activeUser.connection.swid),to:Disney.Friends.createJidFromSwid(a),type:"chat"})).c("received",{xmlns:"urn:xmpp:receipts",id:c}).up().c("snowball",{xmlns:"disney:mobile:snowball"}).up());b&&this.connection.send((new Strophe.Builder("message",{xmlns:"jabber:client",from:Disney.Friends.createJidFromSwid(Disney.Friends.activeUser.connection.swid),to:Disney.Friends.createJidFromSwid(a),type:"chat",playername:"",id:"3D802AA4-3033-45FE-82AF-776EA0E945FE"})).c("snowball",
{xmlns:"disney:mobile:snowball"}).up().c("body").up())},friendOffline:function(a,b){var c=this.friends[a];if(c!==undefined){var d=c.presence.resources,f=d[b];delete c.presence.resources[b];var e=false,g;for(g in d)if(d.hasOwnProperty(g)&&d[g]!==undefined){e=true;if(d[g]>f)return}if(e===false)c.presence.status=Disney.Friends.Presence.Status.OFFLINE;delete c.presence.id;delete c.presence.location;Disney.Friends.Event.updateListeners(Disney.Friends.Event.FRIENDS_UPDATE,c)}},friendOnline:function(a,b,
c){var d=this.friends[a];if(d!==undefined){d.presence.resources[b]=(new Date).getTime();d.presence.status=Disney.Friends.Presence.Status.ONLINE;b=c.find(Disney.Friends.StanzaConstants.ID);if(b.length>0)d.presence.id=parseInt(b.text(),10);else delete this.friends[a].presence.id;a=c.find(Disney.Friends.StanzaConstants.LAND);if(a.length>0)d.presence.location={land:a.attr(Disney.Friends.StanzaConstants.XMLNS),world:a.find("world").text(),room:a.find("room").text()};else delete d.presence.location;d.presence.location&&
Disney.Friends.Event.updateListeners(Disney.Friends.Event.FRIENDS_UPDATE,d)}},characterOffline:function(a){a=this.friends[a];if(a!==undefined){a.presence.status=Disney.Friends.Presence.Status.OFFLINE;Disney.Friends.Event.updateListeners(Disney.Friends.Event.FRIENDS_UPDATE,a)}},characterOnline:function(a){a=this.friends[a];if(a!==undefined){a.presence.status=Disney.Friends.Presence.Status.ONLINE;Disney.Friends.Event.updateListeners(Disney.Friends.Event.FRIENDS_UPDATE,a)}},sendRosterRequest:function(){var a=
this.connection.getUniqueId(),b=$iq({type:Disney.Friends.StanzaConstants.IQ_GET,id:a}).c(Disney.Friends.StanzaConstants.IQ_QUERY,{xmlns:Strophe.NS.ROSTER});this.connection.addHandler(this.populateRoster.bind(this),Strophe.NS.ROSTER,Disney.Friends.StanzaConstants.IQ,null,a);this.connection.send(b)},sendCharacterRosterRequest:function(){var a=this.connection.getUniqueId(),b=$iq({type:Disney.Friends.StanzaConstants.IQ_GET,id:a}).c(Disney.Friends.StanzaConstants.IQ_QUERY,{xmlns:Strophe.NS.CHARACTER_ROSTER});
this.connection.addHandler(this.populateCharacterRoster.bind(this),Strophe.NS.CHARACTER_ROSTER,Disney.Friends.StanzaConstants.IQ,null,a);this.connection.send(b)},sendOrderingPriorityRequest:function(){var a=this.connection.getUniqueId(),b=$iq({type:Disney.Friends.StanzaConstants.IQ_GET,id:a}).c(Disney.Friends.StanzaConstants.IQ_QUERY,{xmlns:Strophe.NS.ORDERING_PRIORITY});this.connection.addHandler(this.populateOrderPriority.bind(this),Strophe.NS.ORDERING_PRIORITY,Disney.Friends.StanzaConstants.IQ,
null,a);this.connection.send(b)},updateFriendItem:function(a,b){var c,d=[],f,e,g;e=Disney.Friends.StanzaConstants;a=$(a);c=Strophe.getNodeFromJid(a.attr(e.JID));if(a.attr(e.SUBSCRIPTION)===e.SUBSCRIPTION_BOTH){a.find("group").each(function(){d.push(Number($(this).text()))});f=a.attr(e.IQ_NAME).split("|");e=Object.create(Disney.Friends.Data.RosterItem);e.swid=c;e.name=f[0];e.safeChatName=f[1]!==undefined?f[1]:null;e.groups=d;e.jumpAvailable=false;f=this.friends[c];g=Disney.Friends.Event.FRIENDS_UPDATE;
if(f===undefined){e.presence={status:Disney.Friends.Presence.Status.OFFLINE,resources:{}};if(b===undefined||b===false)g=Disney.Friends.Event.FRIENDS_NEW}else{e.weight=f.weight;e.presence=$.extend(true,{},f.presence);delete this.friends[c]}this.friends[c]=e;if(b===undefined||b===false)Disney.Friends.Event.updateListeners(g,e);return e}},removeFriendItem:function(a){a=Strophe.getNodeFromJid($(a).attr(Disney.Friends.StanzaConstants.JID));delete this.friends[a];Disney.Friends.Event.updateListeners(Disney.Friends.Event.FRIENDS_REMOVE,
a)},addCharacterItem:function(a){a=$(a);a={character:true,id:Number(a.attr(Disney.Friends.StanzaConstants.ID)),name:a.attr(Disney.Friends.StanzaConstants.IQ_NAME)};var b=this.friends[a.id];if(b===undefined)a.presence={status:Disney.Friends.Presence.Status.OFFLINE};else{a.presence=$.extend(true,{},b.presence);delete this.friends[a.id]}return this.friends[a.id]=a},removeCharacterItem:function(a){a=$(a);a=a.attr(Disney.Friends.StanzaConstants.ID);delete this.friends[a];return a},addPendingItem:function(a){a=
$(a);var b=Strophe.getNodeFromJid(a.attr(Disney.Friends.StanzaConstants.FROM));a=a.find("nick").text().split("|");a={swid:b,name:a[0],safeChatName:a[1]!==undefined?a[1]:null,presence:{status:Disney.Friends.Presence.Status.PENDING}};return this.pending[b]=a},sendIgnoredRequest:function(){var a=this.connection.getUniqueId(),b=$iq({type:Disney.Friends.StanzaConstants.IQ_GET,id:a}).c(Disney.Friends.StanzaConstants.IQ_QUERY,{xmlns:Strophe.NS.IGNORE});this.connection.addHandler(this.populateIgnored.bind(this),
Strophe.NS.IGNORE,Disney.Friends.StanzaConstants.IQ,null,a);this.connection.send(b)},updateIgnoredItem:function(a){a=$(a);var b=Strophe.getNodeFromJid(a.attr("jid")),c=a.attr("remove");if(c!==undefined&&c!==null&&c==="true")delete this.ignored[b];else{a=a.attr("name").split("|");this.ignored[b]={swid:b,name:a[0],safeChatName:a[1]!==undefined?a[1]:null}}},addInteraction:function(a,b){if(this.friends[a]!==undefined){var c=this.connection.getUniqueId();this.connection.send($iq({type:Disney.Friends.StanzaConstants.IQ_SET,
id:c}).c(Disney.Friends.StanzaConstants.IQ_QUERY,{xmlns:Strophe.NS.ORDERING_PRIORITY}).c(Disney.Friends.StanzaConstants.IQ_ITEM,{id:a,increment:b}))}}};Disney.Friends.Settings=function(a){this.connection=a;this.settings={};Strophe.addNamespace("SETTING","disney:friends:setting")};
Disney.Friends.Settings.prototype={initialStanzas:function(){this.sendSettingRequest()},settingRequestHandler:function(){this.sendSettingRequest();return false},settingRequestResultHandler:function(a){if($(a).attr(Disney.Friends.StanzaConstants.STANZA_TYPE)===Disney.Friends.StanzaConstants.IQ_TYPE_ERROR){Disney.Social.logError("Error trying to populate settings. Unable to get settings from server.");return false}a=$(a).find("query setting");this.settings={};if(a.length>0){var b=this;a.each(function(d,
c){c=$(c);var e=c.attr(Disney.Friends.StanzaConstants.SETTING_NAME),f=c.attr(Disney.Friends.StanzaConstants.SETTING_VALUE);b.settings[e]=f})}Disney.Friends.Event.updateListeners(Disney.Friends.Event.FRIENDS_GOT_SETTINGS,this.settings);return false},getSetting:function(a){return this.settings[a]},sendSettingRequest:function(){var a=this.connection.getUniqueId(),b=$iq({type:Disney.Friends.StanzaConstants.IQ_GET,id:a}).c(Disney.Friends.StanzaConstants.IQ_QUERY,{xmlns:Strophe.NS.SETTING});this.connection.addHandler(this.settingRequestResultHandler.bind(this),
Strophe.NS.SETTING,Disney.Friends.StanzaConstants.IQ,null,a);this.connection.send(b)},addSetting:function(a,b){if(this.settings[a]!==b){var d=this.connection.getUniqueId(),c=$iq({type:Disney.Friends.StanzaConstants.IQ_SET,id:d}).c(Disney.Friends.StanzaConstants.IQ_QUERY,{xmlns:Strophe.NS.SETTING}).c(Disney.Friends.StanzaConstants.SETTING_ITEM,{name:a,value:b});this.connection.addHandler(this.settingRequestHandler.bind(this),null,Disney.Friends.StanzaConstants.IQ,null,d);this.connection.send(c)}},
removeSetting:function(a){if(this.settings[a]!==undefined){var b=this.connection.getUniqueId();a=$iq({type:Disney.Friends.StanzaConstants.IQ_SET,id:b}).c(Disney.Friends.StanzaConstants.IQ_QUERY,{xmlns:Strophe.NS.SETTING}).c(Disney.Friends.StanzaConstants.SETTING_ITEM,{name:a,remove:"true"});this.connection.addHandler(this.settingRequestHandler.bind(this),null,Disney.Friends.StanzaConstants.IQ,null,b);this.connection.send(a)}}};
Disney.Friends.Settings.Constants={BEST_FRIEND_ENABLED:"be",BEST_HINT_COUNT:"bc",NOTIFICATION_AWARE:"na"};Disney.Friends.Character=function(a){this.connection=a;this.connection.addHandler(this.messageHandler.bind(this),null,Disney.Friends.StanzaConstants.MESSAGE)};Disney.Friends.Character.prototype={messageHandler:function(a){a=$(a).find("presence");Disney.Friends.Event.updateListeners(Disney.Friends.Event.CHARACTER_INVITE,a[0]);return true}};Disney.Friends.Presence={Status:{OFFLINE:"offline",ONLINE:"online",PENDING:"pending"},DetailLevel:{STATUS:0,LAND:1,LAND_DETAILS:2}};Disney.Friends.Connection=function(a){this.serviceUri=a;this.password=this.swid=this.user=null;this.connectionStatus=Strophe.Status.DISCONNECTED;$(window).unload(function(){Disney.Social.Environment.REMOTE_LOGGING_ENABLED=false;this.disconnect(this.UNLOADING)}.bind(this))};
Disney.Friends.Connection.prototype={UNLOADING:"unloading",GAME_TIMEOUT:"gameTimeout",SERVICE_UNAVAILABLE:"503",RECONNECT_TIME_OUT_LENGTH:2E3,disconnectReason:"",retries:0,connect:function(){if(typeof this.reconnectTimeout==="number"){clearTimeout(this.reconnectTimeout);delete this.reconnectTimeout}if(this.stropheConnection!==undefined){this.stropheConnection.reset();delete this.stropheConnection}if(this.user===null){this.jid=this.swid+"@"+Disney.Friends.PRESENCE_DOMAIN;this.user=new Disney.Friends.User(this);
if(this.swid===undefined||this.swid===null||this.swid.length===0)Disney.Social.RemoteLogging.log(Disney.Social.RemoteLogging.Code.EMPTY_SWID_ERROR);if(this.password===undefined||this.password===null||this.password.length===0)Disney.Social.RemoteLogging.log(Disney.Social.RemoteLogging.Code.EMPTY_PASSWORD_ERROR);Disney.Social.RemoteLogging.swid=this.swid;Disney.Social.RemoteLogging.sendLogMessages(true)}this.stropheConnection=new Strophe.Connection(this.serviceUri);this.stropheConnection.rawInput=this.rawInput;
this.stropheConnection.rawOutput=this.rawOutput;this.stropheConnection.connect(this.jid,this.password,this.connectionCallback.bind(this),Disney.Social.pageLang)},disconnect:function(a){this.send($pres({type:"unavailable"}));if(this.stropheConnection!==undefined){this.stropheConnection._throttledRequestHandler();setTimeout(function(){this.stropheConnection.disconnect(a)}.bind(this),1E3)}},rawInput:function(a){Disney.Social.RemoteLogging.logStropheStanza("I:"+a)},rawOutput:function(a){Disney.Social.RemoteLogging.logStropheStanza("O:"+
a)},connectionCallback:function(a,b){this.connectionStatus=a;switch(a){case Strophe.Status.ERROR:Disney.Analysis.gameActionEvent("connection","error");Disney.Social.RemoteLogging.log(Disney.Social.RemoteLogging.Code.STROPHE_ERROR,"Strophe connection error.");break;case Strophe.Status.CONNECTING:Disney.Analysis.gameActionEvent("connection","connecting");break;case Strophe.Status.CONNFAIL:Disney.Analysis.gameActionEvent("connection","connfail");Disney.Social.RemoteLogging.log(Disney.Social.RemoteLogging.Code.STROPHE_ERROR,
"Strophe failed to connect.");this.reconnect();break;case Strophe.Status.AUTHENTICATING:Disney.Analysis.gameActionEvent("connection","authenticating");break;case Strophe.Status.AUTHFAIL:Disney.Analysis.gameActionEvent("connection","authfail");Disney.Social.RemoteLogging.log(Disney.Social.RemoteLogging.Code.STROPHE_ERROR,"Strophe failed authentication");break;case Strophe.Status.CONNECTED:Disney.Analysis.gameActionEvent("connection","connected");this.connected();this.retries=0;Disney.Social.RemoteLogging.disableStropheStanzaLogging();
break;case Strophe.Status.DISCONNECTED:Disney.Analysis.gameActionEvent("connection","disconnected");this.disconnected(b);break;case Strophe.Status.DISCONNECTING:Disney.Analysis.gameActionEvent("connection","disconnecting");this.disconnecting(b)}},connected:function(){Disney.Friends.activeUser=this.user;var a=new Disney.Friends.Roster(this,this.user);a.initialStanzas();this.user.setRoster(a);a=new Disney.Friends.Settings(this);a.initialStanzas();this.user.setSettings(a);this.characterHandler=new Disney.Friends.Character(this);
this.disconnectReason="";Disney.Friends.Event.updateListeners(Disney.Friends.Event.CONNECTED,{sid:this.stropheConnection.sid})},disconnected:function(a){Disney.Social.logWarn("Disconnected because: "+a);Disney.Friends.Event.updateListeners(Disney.Friends.Event.DISCONNECTED);a!==this.UNLOADING&&a!==this.GAME_TIMEOUT&&this.disconnectReason!==this.UNLOADING&&this.disconnectReason!==this.GAME_TIMEOUT&&this.reconnect()},disconnecting:function(a){Disney.Social.logWarn("Disconnecting because: "+a);this.disconnectReason=
a;if(a===this.SERVICE_UNAVAILABLE){Disney.Friends.Event.updateListeners(Disney.Friends.Event.DISCONNECTED);this.reconnect()}},reconnect:function(){if(!this.reconnectTimeout){this.retries<6&&this.retries++;var a=this.RECONNECT_TIME_OUT_LENGTH*this.retries;a=Math.floor(Math.random()*a+a);this.reconnectTimeout=setTimeout(function(){this.connect()}.bind(this),a)}},isConnected:function(){return this.stropheConnection.connected},sendIQResult:function(a){a=$(a);var b={type:"result",id:a.attr("id")};a=a.attr("from");
if(a!==undefined&&a!==null)b.to=a;this.send($iq(b))},send:function(a){this.stropheConnection!==undefined&&this.stropheConnection!==null&&this.stropheConnection.send(a)},addHandler:function(a,b,c,d,e,f,g){this.stropheConnection.addHandler(a,b,c,d,e,f,g)},getUniqueId:function(){return this.stropheConnection.getUniqueId()}};Disney.Friends.Jump={MAKE_RESERVATION:1,DO_THE_JUMP:2,MAKE_RESERVATION_AND_DO_THE_JUMP:3,START_OF_IGLOO_ROOM_IDS:1E3,availableRoomLocations:{},availableIglooLocations:{},lastPollTimestamp:0,pendingJump:null,jumpEnabled:false,canJump:function(a,b){if(!this.jumpEnabled)return false;var c=Number(b),d=Number(a);if($.inArray(c,this.availableRoomLocations[d])!==-1)return true;d=this.availableIglooLocations[d];if(d===undefined)return false;if($.inArray(c,d.open)!==-1)return true;if($.inArray(c,d.closed)!==
-1){var e=Disney.Friends.activeUser.getRoster().getOnlineFriends(),f;for(f in e)if(e.hasOwnProperty(f)){d=e[f].presence.id;if(d!==undefined&&d+this.START_OF_IGLOO_ROOM_IDS===c)return true}}return false},pollJumpStatus:function(a){if(this.jumpEnabled){a&&this.startPolling();a||this.stopPolling()}},startPolling:function(){if(!this.pollInterval){this.lastPollTimestamp+Disney.Social.Environment.JUMP_STATUS_POLLING_INTERVAL<(new Date).getTime()&&this.pollJumpState();this.pollInterval=setInterval(this.pollJumpState.bind(this),
Disney.Social.Environment.JUMP_STATUS_POLLING_INTERVAL)}},stopPolling:function(){if(!this.pollInterval)return false;clearInterval(this.pollInterval);delete this.pollInterval},pollJumpState:function(){var a=this.findUniqueWorlds();if(a.length>0){this.queryJumpStateServiceForRooms(a);this.lastPollTimestamp=(new Date).getTime()}},findUniqueWorlds:function(){if(Disney.Friends.activeUser===null)return[];var a={},b=Disney.Friends.activeUser.getRoster().getOnlineFriends(),c,d;for(d in b)if(b.hasOwnProperty(d)){c=
b[d];if(c.presence.location!==undefined&&c.presence.location!==null)a[c.presence.location.world]=true}b=[];for(var e in a)b.push(Number(e).valueOf());return b},queryJumpStateServiceForRooms:function(a){a={s:Disney.Friends.activeConnection.swid,l:Disney.Social.getPageLang(),w:a};$.ajax(Disney.Social.Environment.JUMP_STATUS_FOR_ROOMS_URL,{dataType:"jsonp",data:{query:JSON.stringify(a)},success:this.processJumpStateResponseForRooms.bind(this)})},processJumpStateResponseForRooms:function(a){this.availableRoomLocations=
{};this.availableIglooLocations={};for(var b,c=0;c<a.length;c++){b=a[c];this.availableRoomLocations[b.w]=b.r;this.availableIglooLocations[b.w]={open:b.o,closed:b.c}}Disney.Friends.Event.updateListeners(Disney.Friends.Event.JUMP_STATUS_FOR_ROOMS_UPDATE,null)}};Disney.Metrics={metricQueue:[],pendingMetricQueue:{},pendingMetricCounters:{},queueJSONStr:null,init:function(){if(Disney.Social.Environment.METRICS_ENABLED){setInterval(Disney.Metrics.logMetrics.bind(Disney.Metrics),Disney.Social.Environment.METRICS_BATCH_INTERVAL);$(window).unload(function(){Disney.Metrics.logMetrics()})}},fireMetric:function(b,c){var a=Disney.Social.Environment,d=Disney.Metrics;if(!a.METRICS_ENABLED)return true;if(this.metricQueue.length>a.METRICS_MAX_SIZE)return false;if(typeof this.timeoutScroll==
"number"){clearTimeout(this.timeoutScroll);delete this.timeoutScroll;d.endDurationMetric(d.Type.SCROLLING)}this.metricQueue.push(new d.Metric(b,c));this.metricQueue.length>=a.METRICS_BATCH_SIZE&&d.logMetrics()},incrementCounter:function(b,c){if(!Disney.Social.Environment.METRICS_ENABLED)return true;var a=this.pendingMetricCounters[b];if(a===null||a===undefined)return false;a.v[c]++},startDurationMetric:function(b,c){var a=Disney.Social.Environment,d=Disney.Metrics;if(!a.METRICS_ENABLED)return true;
if(this.metricQueue.length>a.METRICS_MAX_SIZE)return false;if(typeof this.timeoutScroll=="number"){clearTimeout(this.timeoutScroll);delete this.timeoutScroll}if(a.METRICS_ENABLED){if(b===d.Type.SCROLLING)this.timeoutScroll=setTimeout(function(){Disney.Metrics.endDurationMetric(b)},4E3);else d.endDurationMetric(d.Type.SCROLLING);a=this.pendingMetricQueue[b];if(a!==undefined&&a!==null)return false;a=new d.Metric(b);this.pendingMetricQueue[b]=a;if(c!==undefined&&c!==null){this.pendingMetricCounters[b]=
{};this.pendingMetricCounters[b].o=c;this.pendingMetricCounters[b].v={};d=0;for(a=c.length;d<a;d++)this.pendingMetricCounters[b].v[c[d]]=0}}},endDurationMetric:function(b,c){if(!Disney.Social.Environment.METRICS_ENABLED)return true;var a,d,e=this.pendingMetricQueue[b];if(e===undefined||e===null)return false;if(b===Disney.Metrics.Type.SCROLLING)if(typeof this.timeoutScroll=="number"){clearTimeout(this.timeoutScroll);delete this.timeoutScroll}e.d=(new Date).getTime()-e.t;e.x=c;var f=this.pendingMetricCounters[b];
if(f!==undefined&&f!==null){if(e.x===undefined)e.x="";var g=f.o;a=0;for(d=g.length;a<d;a++)e.x=e.x+"|"+f.v[g[a]].toString()}Disney.Analysis.timingEvent(e.e,e.d);this.metricQueue.push(e);delete this.pendingMetricQueue[b];delete this.pendingMetricCounters[b]},logMetrics:function(){if(!Disney.Social.Environment.METRICS_ENABLED)return true;if(this.queueJSONStr!==null){this.sendJson();return false}if(this.metricQueue.length>=1){this.queueJSONStr=JSON.stringify(this.metricQueue);this.metricQueue.length=
0;this.sendJson()}},sendJson:function(){var b=Disney.Social.Environment;if(!b.METRICS_ENABLED)return true;if(this.queueJSONStr===null)return false;var c=Disney.Friends,a=c!==undefined&&c.activeUser!==null&&c.activeUser.connection!==null&&c.activeUser.connection.swid!==null;if(b.METRICS_ENABLED&&a){b=b.METRICS_URL+"?"+this.serialize({user:c.activeUser.connection.swid,land:1,events:Disney.Metrics.queueJSONStr});c=new Image;c.onload=function(){this.onload=Disney.Metrics.queueJSONStr=null};c.src=b+"&v="+
(new Date).getTime()}},serialize:function(b){var c="",a;for(a in b)if(b.hasOwnProperty(a)){if(c)c+="&";c+=a.toString()+"="+b[a].toString()}return c}};Disney.Metrics.init();Disney.Metrics.Metric=function(a,b){this.e="friends:"+a;this.t=(new Date).getTime();this.d=0;this.x=b};Disney.Metrics.Type={FRIENDS_CLIENT:"100",FRIENDS_CLIENT_OPEN:"101",FRIENDS_CLIENT_CLOSED:"102",SCROLLING:"300",PLAYER_CARD_REQUESTED:"700",CHARACTER_CARD_REQUESTED:"701",ADD_FRIEND:"800",ADD_FRIEND_SEARCHES:"801",ADD_FRIEND_SUCCESSES:"802",JUMP_PERFORMED:"820",CHARACTER_INVITE_RECEIVED:"830",CHARACTER_INVITE_ACCEPTED:"831",ONLINE_NOTIFICATION_CLICK:"900",TARGET_FRIEND_REQUEST_NOTIFICATION_CLICK:"901",SOURCE_FRIEND_REQUEST_NOTIFICATION_CLICK:"902",ACCEPTS_JUMP_AVAILABLE_NOTIFICATION_CLICK:"903"};Disney.Friends.UI={gotLayout:false,DELAY_NORMAL:1E4,DELAY_FIRST:3E4,BEST_HINT_COUNT_MAX:2,init:function(){$("#D_F_FriendSection").draggable({containment:"window"});this.bestCount=0;this.bestEnabled=false;this.delay=this.DELAY_FIRST;this.notificationAware=false;var a=Disney.Friends.Event;a.addListener(a.DISCONNECTED,this.friendDisconnect.bind(this));a.addListener(a.CONNECTED,this.friendConnect.bind(this));a.addListener(a.FRIENDS_GOT_SETTINGS,this.updateSettings.bind(this));a=Disney.Social.Event;a.addListener(a.EVENT_STOPPED,
this.bubbleEvent.bind(this))},initUIComponents:function(){var a=Disney.Friends.UI;a.Me.init();a.Friends.init();a.FriendsTile.init();a.Pending.init();a.AddFriend.init();a.BarNotification.init();a.ContextNotification.init();$(window).bind("resize",a.resized);a.HudNotification.init()},updateSettings:function(){var a=Disney.Friends.activeUser.settings,b=Disney.Friends.Settings.Constants,c=a.settings[b.BEST_HINT_COUNT];if(c!==undefined)if(c=parseInt(c,10))this.bestCount=c;c=a.settings[b.BEST_FRIEND_ENABLED];
if(c!==undefined&&(c==="true"||c==="false"))this.bestEnabled=true;a=a.settings[b.NOTIFICATION_AWARE];if(a!==undefined&&(a==="true"||a==="false"))if(a==="true"){this.notificationAware=true;this.delay=this.DELAY_NORMAL}else this.notificationAware=true},friendConnect:function(){$("#D_F_FriendSectionReconnect").css("display","none")},friendDisconnect:function(){$("#D_F_FriendSectionReconnect").show()},resized:function(){Disney.Friends.UI.HudNotification.reposition()},toggleFriendsSection:function(){$("#D_F_FriendSection").css("display")===
"none"?this.showFriendsSection():this.hideFriendsSection()},showFriendsSection:function(){if($("#D_F_FriendSection").css("display")==="none"){var a=Disney.Metrics;a.startDurationMetric(a.Type.FRIENDS_CLIENT);a=Disney.Social;var b=Disney.Friends,c=b.UI;$("#D_F_HudNotification").css("display")==="none"&&b.API.pollJumpStatus(true);a.ieVer>0&&a.ieVer<9?$("#D_F_FriendSection").show():$("#D_F_FriendSection").fadeIn(200);c.Friends.updateGrid();c.Friends.updateWidget();c.AddFriend.closePanel();c.BarNotification.update();
c.ContextNotification.bestHintShown=false;c.ContextNotification.showBestHint();c.Images.preloadAvatars();Disney.Analysis.loggingEvent(Disney.Metrics.Type.FRIENDS_CLIENT_OPEN)}},hideFriendsSection:function(){if($("#D_F_FriendSection").css("display")!=="none"){var a=Disney.Metrics,b=a.Type;Disney.Friends.UI.ContextNotification.cancel();Disney.Social.ieVer>0&&Disney.Social.ieVer<9?$("#D_F_FriendSection").css("display","none"):$("#D_F_FriendSection").fadeOut(200);$("#D_F_HudNotification").css("display")===
"none"&&Disney.Friends.API.pollJumpStatus(false);a.endDurationMetric(b.FRIENDS_CLIENT);a.endDurationMetric(b.ADD_FRIEND);a.endDurationMetric(b.SCROLLING);Disney.Analysis.loggingEvent(Disney.Metrics.Type.FRIENDS_CLIENT_CLOSED)}},getCharacterAvatar:function(a,b,c){var d="images/CP/"+b+"_"+c.toString();if($("#D_F_FriendsPanel").data(b)){b=$("#D_F_FriendsPanel").data(b).status;if(!b||b!==Disney.Friends.Presence.Status.ONLINE)d+="Off"}d+=".png";d=Disney.Social.getUrl(d,true);Disney.Friends.UI.Images.checkValidAvatar(a,
d,c)},getAvatarUriByFriendId:function(a,b,c,d,e){c=Disney.Friends.UI.Images;d||(d=88);d=d<88?60:88;if(b.indexOf("character_")===0){this.getCharacterAvatar(a,b,d);return false}if(!b||b==="null"){e="18";if(d<88)e="14";$(a).unbind("load").unbind("error").attr("longdesc",e);Disney.Friends.UI.Images.setAttrs(a,e,false);return false}b=Disney.Social.Environment.CLUB_PENGUIN_AVATAR_URL+"/"+b+"/cp";b+="?size="+d.toString();b+="&language="+Disney.Social.getPageLang();b+=e?"&photo=true":"&photo=false";c.checkValidAvatar(a,
b,d)},getAvatarUriBySwid:function(a,b,c,d){var e=null;if($("#D_F_FriendsGrid").data(b)!==undefined)e=$("#D_F_FriendsGrid").data(b).Id;Disney.Friends.UI.getAvatarUriByFriendId(a,b,e,c,d)},getFriendNameBySwid:function(a){var b="Friend";if(a===undefined||a===null)return b;if($("#D_F_FriendsGrid").data(a)!==undefined)b=$("#D_F_FriendsGrid").data(a).name;return b},getPendingNameBySwid:function(a){var b="";if(a&&Disney.Friends.activeUser&&Disney.Friends.activeUser.roster.pending[a]&&Disney.Friends.activeUser.roster.pending[a].name)b=
Disney.Friends.activeUser.roster.pending[a].name;return b},disableSelectText:function(a){if(typeof document.body.style.webkitUserSelect!=="undefined")$(a).each(function(){this.style.webkitUserSelect="none"});else typeof document.body.onselectstart!=="undefined"&&$(a).each(function(){this.onselectstart=function(){window.event.cancelBubble=true;return false}});typeof document.body.style.MozUserSelect!=="undefined"&&$(a).each(function(){this.style.MozUserSelect="-moz-none"})},frameIt:function(a,b,c,
d,e){$("#"+a).append($("#"+b+" > div").clone(true));$("#"+a+" > .D_F_BoxW").addClass(a+"_BoxW");$("#"+a+" > .D_F_BoxH").addClass(a+"_BoxH");$("#"+a).addClass(a+"_BoxW").addClass(a+"_BoxH");$("."+a+"_BoxW").css("width",c+"px");$("."+a+"_BoxH").css("height",d+"px");$("#"+a+" > .D_F_BoxC").addClass("D_F_BoxCBg"+e);$("#"+a+" > .D_F_BoxT").addClass("D_F_BoxTBg"+e);$("#"+a+" > .D_F_BoxB").addClass("D_F_BoxBBg"+e);$("#"+a+" > .D_F_BoxR").addClass("D_F_BoxRBg"+e);$("#"+a+" > .D_F_BoxL").addClass("D_F_BoxLBg"+
e);$("#"+a+" > .D_F_BoxI").addClass("D_F_BoxIBg"+e)},frameIt20:function(a,b,c,d){$("#"+a).append($("#"+b+" > div").clone(true));$("#"+a+" > .D_F_BoxW20").addClass(a+"_BoxW20");$("#"+a+" > .D_F_BoxH20").addClass(a+"_BoxH20");$("#"+a).addClass(a+"_BoxW20").addClass(a+"_BoxH20");$("."+a+"_BoxW20").css("width",c+"px");$("."+a+"_BoxH20").css("height",d+"px")},setTheme:function(){var a,b=null;a="url('"+Disney.Social.getUrl("css/themes/CP/D_F_btnCloseHover.png",true)+"')";b="url('"+Disney.Social.getUrl("css/themes/CP/D_F_btnClose.png",
true)+"')";$(".D_F_CloseButton").hover(function(){$(this).css("background-image",a)},function(){$(this).css("background-image",b)})},setTagText:function(a){var b=Disney.Friends.UI.Data.text,c=$(a).attr("lang");c=c.substr(c.lastIndexOf("-")+1);if(b.hasOwnProperty(c))for(var d in b[c])switch(d){case "a":$(a).attr("alt",b[c].a);break;case "c":$(a).attr("content",b[c].c);break;case "h":if(a.nodeName.toLowerCase()==="title")document.title=b[c].h;else $(a).html(b[c].h);break;case "r":$(a).attr("href",b[c].r);
break;case "s":$(a).attr("src",Disney.Social.getUrl(b[c].s),true);break;case "t":$(a).attr("title",b[c].t);break;case "v":$(a).attr("value",b[c].v)}},setText:function(a){return!Disney.Friends.UI.Data.text?"":Disney.Friends.UI.Data.text.dynamic[a]},setLayout:function(){var a;a=Disney.Friends.UI;a.gotLayout=true;var b=a.Data;if(!b.markup)return false;$("body").append('<div id="D_F"></div>');$("#D_F").append(b.markup);$("#D_F_FriendSection").unwrap();b.setText();b.setImages();a.init();a.HudNotification.reposition();
a.initUIComponents();a.setTheme();a.disableSelectText(".D_F");a=Disney.Social.ieVer;a>0&&a<8&&$("a").each(function(){$(this).attr("hideFocus","hideFocus")})},resizeFriendsWidgetWith:function(a,b){var c,d,e;if(a){e=[".D_F_SectionW",".D_F_FriendSection_BoxW",".D_F_FriendSectionReconnect_BoxW"];d=e.length;for(c=0;c<d;c++)$(e[c]).each(function(){var f=parseInt($(this).css("width"),10);$(this).css("width",(f+a).toString()+"px")});c=$("#D_F_HeaderTop");d=(c.parent().width()-c.width())/2;c.css("left",d.toString()+
"px");$("#D_F_ReconnectTop").css("left",(d-25).toString()+"px");Disney.Friends.UI.AddFriend.resize();Disney.Friends.UI.BarNotification.resize()}if(b){e=[".D_F_SectionH",".D_F_FriendSection_BoxH",".D_F_FriendSectionReconnect_BoxH"];d=e.length;for(c=0;c<d;c++)$(e[c]).each(function(){var f=parseInt($(this).css("height"),10);$(this).css("height",(f+b).toString()+"px")})}},isVisible:function(a){if(a.parents().map(function(){return $(this).css("display")}).get().indexOf("none")>=0)return false;return true},
showPlayerCard:function(a){if(a.indexOf("character_")===0)a=a.substr(a.indexOf("_")+1);Disney.Friends.API.showPlayerCard(a)},jumpToFriend:function(a){Disney.Friends.API.jumpToFriend(a)},jumpToCharacter:function(a){Disney.Friends.API.jumpToCharacter(a)},bubbleEvent:function(a){a.type==="mousedown"&&$(a.target).parents().map(function(){var b=$(this).attr("id");b&&b==="D_F_FriendSection"&&Disney.Friends.UI.ContextNotification.cancel()})},setBestFriend:function(a){var b=Disney.Friends.UI.Friends,c=b.getGroupIndexBySwid(a);
c=b.groupNames[c[0]];var d=1,e="f";if(c.substr(0,b.BEST_CHARACTER.length)===b.BEST_CHARACTER||c.substr(0,b.BEST_FRIEND.length)===b.BEST_FRIEND)d=0;if(a.indexOf("character_")===0){a=a.substr(a.indexOf("_")+1);e="c"}Disney.Friends.API.updateFriend({swid:a,groups:[d],type:e});Disney.Friends.activeUser!==null&&Disney.Friends.activeUser.settings.addSetting(Disney.Friends.Settings.Constants.BEST_HINT_COUNT,Disney.Friends.UI.BEST_HINT_COUNT_MAX.toString())},animateSprite:function(a,b,c,d,e,f){var i=0,g=
1,h=1,j=(new Date).getTime();e=1E3/e;var l=function(){$(a).css("background-position","-"+i.toString()+"px 0px");if(d&&d[g]&&h<d[g]){h++;g--}else{h=1;i+=b}if(++g<=c){var k=(new Date).getTime();setTimeout(l,e-(k-j));j=k}else setTimeout(function(){$(a).remove();f()},e*2)};l()}};Disney.Friends.UI.Event={FRIENDS_COUNT:"friendsCount",PENDINGS_UPDATED:"pendingsUpdated",PENDING_ACCEPTED:"pendingAccepted",PENDING_REJECTED:"pendingRejected",PENDING_REMOVED:"pendingRemoved",SUBPANEL_TOGGLED:"subpanelToggled",init:function(){this.eventManager=Object.create(Disney.Social.EventAbstract);this.eventManager.listeners={}},addListener:function(a,b){this.eventManager.addListener(a,b)},removeListener:function(a){this.eventManager.removeListener(a)},updateListeners:function(){this.eventManager.updateListeners.apply(this.eventManager,
Array.prototype.slice.call(arguments,0))}};Disney.Friends.UI.Event.init();Disney.Friends.UI.Images={implicit:{u:"images/D_F_implicit.gif",d:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAgY0hSTQAAeiYAAICEAAD6AAAAgOgAAHUwAADqYAAAOpgAABdwnLpRPAAAAAtJREFUCB1j+M8AAAIBAQDFXxteAAAAAElFTkSuQmCC"},queue:[],isSet:false,init:function(){var b=Disney.Social,a=Disney.Friends.UI.Images;if(a.isSet||!Disney.Friends.UI.Data.images||!Disney.Friends.UI.gotLayout)return false;$(".D_F img").each(function(){var c=$(this).attr("longdesc");
c&&!$(this).hasClass("D_F_FriendAvatar")&&Disney.Friends.UI.Images.setAttrs(this,c,true)});if(b.ieVer>0&&b.ieVer<8){$.preloadCssImages();this.preloadAll()}a.processQueue();a.isSet=true},setImplicit:function(){if(Disney.Friends.UI.Data.images)return false;$(".D_F img").each(function(){var b,a,c=Disney.Friends.UI.Images;b=$(this).attr("longdesc");a=$(this).attr("alt");if(b&&!a){a=c.implicit.d;if(Disney.Social.ieVer>0&&Disney.Social.ieVer<8)a=Disney.Social.getUrl(c.implicit.u,true);$(this).attr("src",
a);Disney.Friends.UI.Data.images||c.queue.push({i:b,e:this})}})},processQueue:function(){for(var b,a=Disney.Friends.UI.Images;a.queue.length>0;){b=a.queue.shift();a.setAttrs(b.e,b.i,false)}},getSrcById:function(b){var a,c=Disney.Friends.UI.Data,e="";if(!c.images.hasOwnProperty(b))return e=Disney.Social.getUrl(Disney.Friends.UI.Images.implicit.u,true);a=c.images[b].u;if(Disney.Social.ieVer>0&&Disney.Social.ieVer<8)e=Disney.Social.getUrl(a,true);else if(a=a.substr(a.lastIndexOf(".")+1))e="data:image/"+
a+";base64,"+c.images[b].d;return e},getHWbyId:function(b){var a=Disney.Friends.UI.Data;if(!a.images.hasOwnProperty(b))return[];return[a.images[b].h,a.images[b].w]},setAttrs:function(b,a,c){if(!b||!a)return false;var e=Disney.Friends.UI.Images;if(!Disney.Friends.UI.Data.images){c&&e.queue.push({i:a,e:b});return false}e.setHW(b,a);e.setSrc(b,a)},setSrc:function(b,a){if(!b||!a)return false;$(b).attr("src",Disney.Friends.UI.Images.getSrcById(a))},setHW:function(b,a){var c;if(!b||!a)return false;if($(b).attr("height"))return false;
c=Disney.Friends.UI.Images.getHWbyId(a);b&&c&&c.length===2&&$(b).attr("width",c[1]).attr("height",c[0])},preloadAll:function(){var b,a=Disney.Friends.UI.Data;for(b in a.images)a.images.hasOwnProperty(b)&&Disney.Friends.UI.Images.loadImage(Disney.Social.getUrl(a.images[b].u),true)},loadImage:function(b){var a=new Image;a.onerror=function(){$(this).unbind("error").attr("src",Disney.Social.getUrl(Disney.Friends.UI.Images.implicit.u,true))};a.src=b},getAvatarCache:function(b,a){var c=false;if($("#D_F_FriendsPanel").data(b)&&
$("#D_F_FriendsPanel").data(b).cache&&$("#D_F_FriendsPanel").data(b).cache[a])c=$("#D_F_FriendsPanel").data(b).cache[a];return c},setAvatarCache:function(b,a,c){if(!b||!a)return false;if($("#D_F_FriendsPanel").data(b)){if(!$("#D_F_FriendsPanel").data(b).cache)$("#D_F_FriendsPanel").data(b).cache={};$("#D_F_FriendsPanel").data(b).cache[a]=c}},preloadAvatars:function(){var b=36,a,c;a=Disney.Friends.UI.Friends;var e=a.arrAllFriends,d=a.getIndexAllFriends(),f=e.length;if(d>f)d=f-1;d-=9;if(d<0)d=0;for(b+=
d;d<f;d++){if(d>b)break;c=e[d];if(!(!c||c==="null"||c.indexOf("character_")===0)){a=this.getAvatarCache(c,88);if(!a){b=Disney.Social.Environment.CLUB_PENGUIN_AVATAR_URL+"/"+c+"/cp?size=88&language="+Disney.Social.getPageLang()+"&photo=true";Disney.Friends.UI.Images.preloadAvatar(b);break}}}},preloadAvatar:function(b){var a=new Image;a.onload=function(){var c,e,d,f;d=this.src;var g=d.lastIndexOf("%7B")+3,h=Disney.Friends.UI.Images;if(g>0)f=d.indexOf("%7D",g);if(g>0&&f>g)c="{"+d.substring(g,f)+"}";
f=d.slice(d.indexOf("?")+1).split("&");for(g=0;g<f.length;g++){d=f[g].split("=");if(d[0]==="size")e=d[1]}if(c&&e){h.setAvatarCache(c,e,true);h.preloadAvatars()}};a.src=b},checkValidAvatar:function(b,a,c){var e="18";if(c<88)e="14";$(b).unbind("load").unbind("error").attr("longdesc",e).error(function(){if(Disney.Social.ieVer<9){$(this).unbind("error");var d=$(this).attr("longdesc");Disney.Friends.UI.Images.setAttrs(this,d,false)}}).load(function(){Disney.Social.ieVer<9&&$(this).unbind("load")}).attr("src",
a)}};Disney.Friends.UI.HudNotification={SLIDE_TIME:500,CHARACTER_ONLINE:"CO",CHARACTER_INVITE:"CI",FRIEND_ACCEPTANCE:"FA",FRIEND_REQUEST:"FR",JUMP_AVAILABLE:"FJ",FRIEND_ONLINE:"FO",crtSwid:null,crtNotifyType:null,characterPresences:{},timeStarted:null,crtArray:null,crtSplice:0,requestCount:1,init:function(){var a=Disney.Friends.Event,b=Disney.Friends.UI.Event,c,d;this.notifyTypes=[this.CHARACTER_ONLINE,this.CHARACTER_INVITE,this.FRIEND_ACCEPTANCE,this.JUMP_AVAILABLE,this.FRIEND_ONLINE,this.FRIEND_REQUEST];
this.notifyArrays=[];d=this.notifyTypes.length;for(c=0;c<d;c++)this.notifyArrays.push([]);Disney.Friends.UI.frameIt("D_F_HudNotifBubble","D_F_Box25Template",190,30,"2");a.addListener(a.HUD_UPDATE,this.hudUpdate.bind(this));a.addListener(a.FRIENDS_JUMP_AVAILABLE,this.notifyJump.bind(this));a.addListener(a.CHARACTER_INVITE,this.notifyInvite.bind(this));b.addListener(b.PENDINGS_UPDATED,this.pendingsUpdated.bind(this));b.addListener(b.PENDING_ACCEPTED,this.clearRequest.bind(this));b.addListener(b.PENDING_REJECTED,
this.clearRequest.bind(this));$("#D_F_HudNotifClose").mousedown(function(e){Disney.Social.stopEvent(e);Disney.Friends.UI.HudNotification.close()});$("#D_F_HudNotifBubble").mousedown(function(e){Disney.Social.stopEvent(e);Disney.Friends.UI.HudNotification.notificationClick()});$("#D_F_HudNotification").mouseenter(function(e){Disney.Social.stopEvent(e);Disney.Friends.UI.HudNotification.bindMouseLeave()});this.bindClickAvatar();this.bindClickAccept();this.bindClickReject()},hudUpdate:function(a){var b=
Disney.Friends.UI.HudNotification;if(b.hudVisible=a)b.rescan();else{this.crtArray=null;this.crtSplice=0;b.close()}},pendingsUpdated:function(a){var b=Disney.Friends.UI.HudNotification;b.notify(a.name,b.FRIEND_REQUEST,a.swid)},notifyJump:function(a){var b,c;if(!a)return false;if(!$("#D_F_FriendsPanel").data(a))return false;b=$("#D_F_FriendsPanel").data(a).name;c=$("#D_F_FriendsPanel").data(a).roomId;if(!b||!c)return false;this.notify(b,this.JUMP_AVAILABLE,a);Disney.Friends.UI.ContextNotification.hide();
Disney.Friends.UI.Friends.meUpdate()},notifyInvite:function(a){var b,c,d,e;a=$(a);b=Number(a.find("characterId").text());c=Number(a.find("id").text());if(!a||!Disney.Social.Data.mascots||!Disney.Social.Data.mascots[b])return false;d="character_"+b;e=Disney.Social.Data.mascots[b].name;this.characterPresences[d]={id:c,location:{world:Number(a.find("worldId").text()),room:Number(a.find("roomId").text())}};this.notify(e,this.CHARACTER_INVITE,d);Disney.Analysis.loggingEvent(Disney.Metrics.Type.CHARACTER_INVITE_RECEIVED,
b)},reposition:function(){var a,b=Disney.ClubPenguin.getNotifyPosition();a=$("#D_F_HudNotification").height();$("#D_F_HudNotification").css("top",(b.top-a).toString()+"px");$("#D_F_HudNotification").css("left",(b.left-83).toString()+"px")},bindClickAvatar:function(){$("#D_F_HudNotifCard").unbind("mousedown").mousedown(function(a){Disney.Social.stopEvent(a);a=Disney.Friends.UI.HudNotification.crtSwid;typeof a==="string"?Disney.Friends.UI.showPlayerCard(a):Disney.Friends.UI.HudNotification.notificationClick()})},
bindClickAccept:function(){$("#D_F_HudNotifBtnY").mousedown(function(a){Disney.Social.stopEvent(a);a=Disney.Friends.UI.HudNotification.crtSwid;Disney.Friends.UI.HudNotification.close();Disney.Friends.UI.Pending.accept(a)})},bindClickReject:function(){$("#D_F_HudNotifBtnN").mousedown(function(a){Disney.Social.stopEvent(a);a=Disney.Friends.UI.HudNotification.crtSwid;Disney.Friends.UI.HudNotification.close();Disney.Friends.UI.Pending.reject(a)})},bindMouseLeave:function(){Disney.Friends.UI.HudNotification.clearTimer();
$("#D_F_HudNotification").unbind("mouseleave").mouseleave(function(a){$(this).unbind("mouseleave");Disney.Social.stopEvent(a);a=Disney.Friends.UI.HudNotification;if(a.hidding)return false;a.clearTimer();a.slidedUp()})},notificationClick:function(){Disney.Friends.UI.showFriendsSection();switch(this.crtNotifyType){case this.CHARACTER_ONLINE:case this.FRIEND_ONLINE:Disney.Analysis.loggingEvent(Disney.Metrics.Type.ONLINE_NOTIFICATION_CLICK);break;case this.FRIEND_REQUEST:Disney.Analysis.loggingEvent(Disney.Metrics.Type.TARGET_FRIEND_REQUEST_NOTIFICATION_CLICK);
break;case this.FRIEND_ACCEPTANCE:Disney.Analysis.loggingEvent(Disney.Metrics.Type.SOURCE_FRIEND_REQUEST_NOTIFICATION_CLICK);break;case this.JUMP_AVAILABLE:Disney.Analysis.loggingEvent(Disney.Metrics.Type.ACCEPTS_JUMP_AVAILABLE_NOTIFICATION_CLICK)}},deQueue:function(){var a,b,c,d,e,f,g,h;if(this.crtArray&&this.crtSplice){this.crtArray.splice(0,this.crtSplice);this.crtArray=null;this.crtSplice=0}h=this.notifyTypes.length;for(a=0;a<h;a++){c=this.notifyTypes[a];e=this.notifyArrays[a];g=e.length;if(g>
0){b=e[0].n;d=e[0].s;if(c===this.CHARACTER_ONLINE||c===this.CHARACTER_INVITE)f=1;else if(g>1){b=g.toString();d=[];for(a=0;a<g;a++)d.push(e[a].s);f=e.length}else f=1;break}}if(b&&c&&d){if(c===this.FRIEND_REQUEST){this.accumulateTimeout&&clearTimeout(this.accumulateTimeout);if(f>this.requestCount){this.requestCount=f;this.accumulateTimeout=setTimeout(function(){Disney.Friends.UI.HudNotification.rescan()},Disney.Friends.UI.delay);return false}else this.requestCount=1}this.crtArray=e;this.crtSplice=f;
setTimeout(function(){this.show(b,c,d)}.bind(this),50)}},show:function(a,b,c){this.timeStarted=(new Date).getTime();Disney.Friends.API.showingNotification();this.crtSwid=null;this.crtNotifyType=b;this.reposition();var d,e,f,g,h=Disney.Social;$(".D_F_HudNotifBubble_BoxW").css("width","190px");$("#D_F_HudNotifLine2").show();$("#D_F_HudNotifJump").css("display","none").siblings("input[type=hidden]").val(c);g=$("#D_F_HudNotifLine1");f=$("#D_F_HudNotifLine2");$("#D_F_HudNotifBtns").css("display","none");
if(b===this.CHARACTER_ONLINE||b===this.CHARACTER_INVITE){Disney.Friends.UI.getAvatarUriBySwid("#D_F_HudNotifAvatar",c,60,false);d=Disney.Friends.UI.setText("D4");if(b===this.CHARACTER_INVITE){e=Disney.Friends.UI.HudNotification.characterPresences[c];$("#D_F_HudNotifBtns").show()}}else if(typeof c==="string"){Disney.Friends.UI.getAvatarUriBySwid("#D_F_HudNotifAvatar",c,60,false);this.crtSwid=c;switch(b){case this.FRIEND_ACCEPTANCE:$("#D_F_HudNotifBtnY").css("zoom","").hide();$("#D_F_HudNotifBtnN").css("zoom",
"").hide();d=Disney.Friends.UI.setText("D8").replace("{0}",a);g=$("#D_F_HudNotifLine2");g.css("display","none");f=$("#D_F_HudNotifLine1");break;case this.FRIEND_REQUEST:d=Disney.Friends.UI.setText("D6");break;case this.JUMP_AVAILABLE:d=Disney.Friends.UI.setText("D2");break;case this.FRIEND_ONLINE:d=Disney.Friends.UI.setText("D4")}$("#D_F_HudNotifBtns").show()}else{Disney.Friends.UI.Images.setAttrs("#D_F_HudNotifAvatar","14",false);switch(b){case this.FRIEND_ACCEPTANCE:d=Disney.Friends.UI.setText("D12").replace("{0}",
a);g=$("#D_F_HudNotifLine2");g.css("display","none");f=$("#D_F_HudNotifLine1");break;case this.FRIEND_REQUEST:d=Disney.Friends.UI.setText("D5").replace("{0}",a);g=$("#D_F_HudNotifLine2");g.css("display","none");f=$("#D_F_HudNotifLine1");break;case this.JUMP_AVAILABLE:a+=" "+Disney.Friends.UI.setText("D9");d=Disney.Friends.UI.setText("D1");break;case this.FRIEND_ONLINE:a+=" "+Disney.Friends.UI.setText("D9");d=Disney.Friends.UI.setText("D3")}}g.empty().text(a).css("font-weight","bold");f.empty().text(d).css("font-weight",
"normal");$("#D_F_HudNotifBtnY").css("display","none").css("zoom","");$("#D_F_HudNotifBtnN").css("display","none").css("zoom","");if(b===this.FRIEND_REQUEST&&typeof c==="string")if(h.ieVer>0&&h.ieVer<8){$("#D_F_HudNotifBtnY").css("zoom","1").css("display","inline");$("#D_F_HudNotifBtnN").css("zoom","1").css("display","inline")}else{$("#D_F_HudNotifBtnY").css("display","inline-block");$("#D_F_HudNotifBtnN").css("display","inline-block")}Disney.Friends.UI.Friends.updateJump($("#D_F_HudNotifJump"),e);
$("#D_F_FriendSection").css("display")==="none"&&Disney.Friends.API.pollJumpStatus(true);$("#D_F_HudNotification").show();$("#D_F_HudNotifBtnY").width();$("#D_F_HudNotifBtnN").width();Disney.Friends.UI.HudNotification.reStyleBubble();$("#D_F_HudNotifBubble").stop(true,false).css("top","124px").animate({top:"-=99"},Disney.Friends.UI.HudNotification.SLIDE_TIME,Disney.Friends.UI.HudNotification.slidedUp)},reStyleBubble:function(){var a,b;if($("#D_F_HudNotification").css("display")==="none")return false;
$("#D_F_HudNotifMessage").css("top",((30-$("#D_F_HudNotifMessage").height()-$("#D_F_HudNotifBtns").height())/2).toString()+"px");$("#D_F_HudNotifBtns").css("top",(parseInt($("#D_F_HudNotifMessage").css("top"),10)+$("#D_F_HudNotifMessage").height()+2).toString()+"px");$("#D_F_HudNotifBtnJ").css("display")==="none"?$("#D_F_HudNotifRoom").css("text-align","left").css("left","0px").css("color","gray"):$("#D_F_HudNotifRoom").css("left","5px").css("text-align","center");a=0;if($("#D_F_HudNotifLine1").css("display")!==
"none")a=Math.max(a,$("#D_F_HudNotifLine1").width());if($("#D_F_HudNotifLine2").css("display")!=="none")a=Math.max(a,$("#D_F_HudNotifLine2").width());if($("#D_F_HudNotifBtnJ").css("display")!=="none")a=Math.max(a,$("#D_F_HudNotifBtnJ").width());if($("#D_F_HudNotifRoom").css("display")!=="none")a=Math.max(a,$("#D_F_HudNotifRoom").width());if($("#D_F_HudNotifBtnY").css("display")!=="none"&&$("#D_F_HudNotifBtnN").css("display")!=="none"){b=$("#D_F_HudNotifBtnY").width()+$("#D_F_HudNotifBtnN").width();
a=Math.max(a,b)}if(a>130)a=130;if(a<60)a=60;$(".D_F_HudNotifBubble_BoxW").css("width",(60+a).toString()+"px")},slidedUp:function(){var a=Disney.Friends.UI.HudNotification,b=Disney.Friends.UI.delay;if(a.timeStarted){var c=(new Date).getTime()-a.timeStarted;if(c>=b)c=b-20;b-=c}a.timeout=setTimeout(function(){Disney.Friends.UI.HudNotification.hide()},b)},hide:function(){var a=Disney.Friends.UI.HudNotification;a.hidding=true;$("#D_F_HudNotification").unbind("mouseleave");$("#D_F_HudNotifBubble").stop(true,
false).css("top","26px").animate({top:"+=99"},a.SLIDE_TIME,a.slidedDown)},slidedDown:function(){$("#D_F_HudNotification").hide();var a,b,c=Disney.Friends.UI.HudNotification;c.hidding=false;$("#D_F_FriendSection").css("display")==="none"&&Disney.Friends.API.pollJumpStatus(false);Disney.Friends.UI.delay=Disney.Friends.UI.DELAY_NORMAL;if(!Disney.Friends.UI.notificationAware&&Disney.Friends.activeUser!==null){a=Disney.Friends.Settings.Constants.NOTIFICATION_AWARE;b=Disney.Friends.activeUser.settings;
b.settings[a]||b.addSetting(a,"true")}c.timeStarted=null;Disney.Friends.API.closedNotification();c.rescan()},clearTimer:function(){var a=Disney.Friends.UI.HudNotification;typeof a.timeout==="number"&&clearTimeout(a.timeout)},close:function(){var a=Disney.Friends.UI.HudNotification;a.clearTimer();$("#D_F_HudNotification").unbind("mouseleave");$("#D_F_HudNotifBubble").stop(true,false);$("#D_F_HudNotification").hide();$("#D_F_HudNotifBubble").css("top","124px");a.timeStarted=null;Disney.Friends.API.closedNotification();
a.rescan()},rescan:function(){var a=Disney.Friends.UI.HudNotification;if(!a.hudVisible||a.timeStarted)return false;a.deQueue()},clearRequest:function(a){if(!a)return false;var b=Disney.Friends.UI.HudNotification,c,d,e,f;c=b.notifyTypes.indexOf(b.FRIEND_REQUEST);e=b.notifyArrays[c];f=-1;d=e.length;for(c=0;c<d;c++)if(e[c].s===a){f=c;break}f>-1&&e.splice(f,1);a===b.crtSwid&&b.crtNotifyType===b.FRIEND_REQUEST&&b.close()},notify:function(a,b,c){if(!a||!b||!c)return false;var d,e;b=this.notifyTypes.indexOf(b);
if(b<0)return false;e=this.notifyArrays[b];d=e.length;for(b=0;b<d;b++)if(e[b].s===c)return false;e.push({s:c,n:a});this.rescan()}};Disney.Friends.UI.ContextNotification={bestHintShown:false,queue:[],init:function(){Disney.Friends.UI.frameIt("D_F_ContextNotification","D_F_Box25Template",150,30,"2");var a=Disney.Friends.Event;a.addListener(a.FRIENDS_JUMP_FAILED,this.showJumpError.bind(this));$("#D_F_ContextNotifClose").mousedown(function(b){Disney.Social.stopEvent(b);Disney.Friends.UI.ContextNotification.hide()})},showBestHint:function(){var a=Disney.Friends.UI,b,c;b=a.ContextNotification;if(a.bestCount>=a.BEST_HINT_COUNT_MAX||
b.bestHintShown||!a.bestEnabled&&a.Friends.arrAllFriends.length<10)return false;if(b.active){b.queue.indexOf("show_best")<0&&b.queue.push("show_best");return false}if($("#D_F_FriendSection").css("display")==="none")return false;b.bestHintShown=true;a.bestCount++;if(Disney.Friends.activeUser!==null){b=Disney.Friends.Settings.Constants.BEST_HINT_COUNT;c=Disney.Friends.activeUser.settings;c.addSetting(b,a.bestCount.toString())}this.delay=a.DELAY_FIRST;$("#D_F_ContextNotifUp").css("left","33px").show();
a.Images.setAttrs("#D_F_ContextNotifIcon","41",false);$("#D_F_ContextNotifText").text(a.setText("D11"));$(".D_F_ContextNotification_BoxH").css("height","30px");$(".D_F_ContextNotification_BoxW").css("width","140px");$("#D_F_ContextNotifText").css("height","48px").css("width","85px");$("#D_F_ContextNotification").css("top","60px").css("left","60px");this.display()},showJumpError:function(a){var b,c,d;if($("#D_F_FriendSection").css("display")==="none")return false;if(!a)return false;c=Disney.Friends.UI.Friends.getTileIdBySwid(a);
if(!c)return false;if(self.active){self.queue.indexOf(a)<0&&self.queue.push(a);return false}this.delay=Disney.Friends.UI.delay;$(".D_F_ContextNotification_BoxH").css("height","30px");$(".D_F_ContextNotification_BoxW").css("width","150px");$("#D_F_ContextNotifText").css("height","51px").css("width","100px");a=$("#"+c).position();b=$("#"+c).parent().position();c=a.top+b.top+155;b=a.left+b.left+25;d=-5;switch(a.left){case 100:b-=50;d+=50;break;case 200:b-=100;d+=100}if(a.top===256){c-=120;$("#D_F_ContextNotifDn").show()}else $("#D_F_ContextNotifUp").show();
$("#D_F_ContextNotification").css("top",c.toString()+"px").css("left",b.toString()+"px");$("#D_F_ContextNotifUp").css("left",d.toString()+"px");$("#D_F_ContextNotifDn").css("left",d.toString()+"px");Disney.Friends.UI.Images.setAttrs("#D_F_ContextNotifIcon","42",false);$("#D_F_ContextNotifText").text(Disney.Friends.UI.setText("D14"));this.display()},display:function(){var a=Disney.Friends.UI.ContextNotification;$("#D_F_ContextNotification").show();a.clearTimer();a.timeout=setTimeout(function(){Disney.Friends.UI.ContextNotification.hide()},
a.delay)},clearTimer:function(){var a=Disney.Friends.UI.ContextNotification;if(typeof a.timeout==="number"){clearTimeout(a.timeout);delete a.timeout}},hide:function(){var a=Disney.Friends.UI.ContextNotification;a.clearTimer();$("#D_F_ContextNotification").css("display","none");$("#D_F_ContextNotifUp").css("display","none");$("#D_F_ContextNotifDn").css("display","none");var b=Disney.Friends.UI;b.delay=b.DELAY_NORMAL;a.active=false;a.loop()},cancel:function(){var a=Disney.Friends.UI.ContextNotification;
a.clearTimer();a.queue.length=0;a.hide()},loop:function(){var a,b=Disney.Friends.UI.ContextNotification;if(b.queue.length>0){a=b.queue.shift();a.indexOf("show_best")===0?b.showBestHint():b.showJumpError(a)}}};Disney.Friends.UI.Data={markup:null,text:null,images:null,init:function(){if(typeof this.timeoutID==="number"){clearTimeout(this.timeoutID);delete this.timeoutID}if(this.markup&&this.text&&this.images)return false;var b=Disney.Social,c=b.Environment,a=Disney.Social.RemoteLogging;if(!this.markup){a.log(a.Code.MARKUP_DATA_REQUEST);$.ajax(b.getUrl(c.FRIENDS_BASE_URL,c.MARKUP_PATH),{cache:true,dataType:"jsonp",jsonpCallback:"markupData",success:function(d){Disney.Friends.UI.Data.markup=d;Disney.Friends.UI.Data.setMarkup();
a.log(a.Code.MARKUP_DATA_SUCCESS)}})}if(!this.text){a.log(a.Code.TEXT_DATA_REQUEST);$.ajax(b.getUrlForLanguage(c.FRIENDS_BASE_URL,c.TEXT_PATH),{cache:true,dataType:"jsonp",jsonpCallback:"textData",success:function(d){Disney.Friends.UI.Data.text=d;Disney.Friends.UI.Data.setText();a.log(a.Code.TEXT_DATA_SUCCESS)}})}if(!this.images){a.log(a.Code.IMAGE_DATA_REQUEST);$.ajax(b.getUrl(c.FRIENDS_BASE_URL,c.IMAGES_PATH),{cache:true,dataType:"jsonp",jsonpCallback:"imagesData",success:function(d){Disney.Friends.UI.Data.images=
d;Disney.Friends.UI.Data.setImages();a.log(a.Code.IMAGE_DATA_SUCCESS)}})}this.timeoutID=setTimeout(function(){Disney.Friends.UI.Data.init()},12E4)},setMarkup:function(){var b=Disney.Friends.UI;if(!b.gotLayout)return false;b.setLayout()},setText:function(){var b=Disney.Friends.UI;if(!b.Data.text||!b.gotLayout)return false;$("[lang]").each(function(){this.nodeName.toLowerCase()!=="html"&&b.setTagText(this)});Disney.Friends.UI.Images.setImplicit()},setImages:function(){Disney.Friends.UI.Images.init()}};
Disney.Friends.UI.Data.init();Disney.Friends.UI.Me={worldId:null,roomId:null,init:function(){$("#D_F_FriendsSectionClose").mousedown(function(b){Disney.Social.stopEvent(b);Disney.Friends.UI.hideFriendsSection()});var a=Disney.Friends.Event;a.addListener(a.USER_PRESENCE_UPDATE,this.updatePresence.bind(this))},updatePresence:function(a){if(!a)return false;this.worldId=$(a).find("world").text();this.roomId=$(a).find("room").text();Disney.Friends.UI.Friends.meUpdate()}};Disney.Friends.UI.Slider={crtSlider:null,crtHandle:null,crtPanel:null,crtFadingUp:null,crtFadingDn:null,totalScroll:0,handleHeightMin:52,sliderStep:1,sliderMin:0,sliderMax:100,holdScroll:null,init:function(a,b,e,d,f,g){if(a){b||(b=0);e||(e=0);d||(d=0);if(f)this.sliderMax=f;if(g)this.sliderMax=g;this.crtPanel=$("#"+a);this.crtPanel.parent().append($("#D_F_GenericSliderTemplate > div").clone(true));this.crtSlider=$(this.crtPanel.siblings(":last").children(".D_F_Slider")[0]);this.crtSlider.slider({orientation:"vertical",
range:"min",min:this.sliderMin,max:this.sliderMax,value:0,start:function(){var c=Disney.Metrics;c.startDurationMetric(c.Type.SCROLLING)},slide:function(c,h){this.scrollToValue(h)}.bind(this)});this.crtHandle=this.crtSlider.find(".ui-slider-handle")[0];this.buildHandle();this.crtSlider.parent().css("top",b.toString()+"px").css("right",e.toString()+"px").css("height",d.toString()+"px");this.crtSlider.show();a=this.crtSlider.parent().find(".D_F_SliderArrowTop")[0];$(a).mousedown(function(c){Disney.Social.stopEvent(c);
this.scrollUp();c=Disney.Metrics;c.startDurationMetric(c.Type.SCROLLING);this.holdScroll=setInterval(function(){this.scrollUp()}.bind(this),100)}.bind(this));$(a).mouseup(function(c){Disney.Social.stopEvent(c);this.holdScroll&&clearInterval(this.holdScroll)}.bind(this));a=this.crtSlider.parent().find(".D_F_SliderTop")[0];$(a).mousedown(function(c){Disney.Social.stopEvent(c);this.scrollToTop();c=Disney.Metrics;c.startDurationMetric(c.Type.SCROLLING)}.bind(this));a=this.crtSlider.parent().find(".D_F_SliderBottom")[0];
$(a).mousedown(function(c){Disney.Social.stopEvent(c);this.scrollBottom();c=Disney.Metrics;c.startDurationMetric(c.Type.SCROLLING)}.bind(this));a=this.crtSlider.parent().find(".D_F_SliderArrowBottom")[0];$(a).mousedown(function(c){Disney.Social.stopEvent(c);this.scrollDown();c=Disney.Metrics;c.startDurationMetric(c.Type.SCROLLING);this.holdScroll=setInterval(function(){this.scrollDown()}.bind(this),100)}.bind(this));$(a).mouseup(function(c){Disney.Social.stopEvent(c);this.holdScroll&&clearInterval(this.holdScroll)}.bind(this))}},
buildHandle:function(){$(this.crtHandle).append($("#D_F_SliderHandleTopTemplate > div").clone(true));$(this.crtHandle).append($("#D_F_SliderHandleBottomTemplate > div").clone(true))},bindMousewheel:function(){var a=this;a.crtPanel.unbind("mousewheel").bind("mousewheel",function(b,e){Disney.Social.stopEvent(b);a.onMousewheel();a.mousewheelSlide(e);var d=Disney.Metrics;d.startDurationMetric(d.Type.SCROLLING)});a.crtSlider.parent().unbind("mousewheel").bind("mousewheel",function(b,e){Disney.Social.stopEvent(b);
a.onMousewheel();a.mousewheelSlide(e);var d=Disney.Metrics;d.startDurationMetric(d.Type.SCROLLING)})},unbindMousewheel:function(){this.scrollToTop();this.crtPanel.unbind("mousewheel");this.crtSlider.parent().unbind("mousewheel")},scrollToValue:function(a){var b=Math.round(this.totalScroll*(this.sliderMax-a.value)/this.sliderMax);b=this.getCustomTop(b,a.value);this.crtPanel.scrollTop(b);if(this.crtFadingUp)a.value===this.sliderMax||this.crtSlider.parent().css("display")==="none"?this.crtFadingUp.css("display",
"none"):this.crtFadingUp.show();if(this.crtFadingDn)a.value===this.sliderMin||this.crtSlider.parent().css("display")==="none"?this.crtFadingDn.css("display","none"):this.crtFadingDn.show()},getCustomTop:function(a){return a},onMousewheel:function(){},scrollUp:function(){this.mousewheelSlide(1)},scrollDown:function(){this.mousewheelSlide(-1)},scrollToTop:function(){this.scrollToValue({value:this.sliderMax});this.crtSlider.slider("value",this.sliderMax)},scrollBottom:function(){this.scrollToValue({value:this.sliderMin});
this.crtSlider.slider("value",this.sliderMin)},mousewheelSlide:function(a){var b=this.crtSlider.slider("value");if(b===this.sliderMax&&a>0||b===this.sliderMin&&a<0)return false;b+=a*this.sliderStep;if(b>this.sliderMax)b=this.sliderMax;if(b<this.sliderMin)b=this.sliderMin;this.scrollToValue({value:b});this.crtSlider.slider("value",b)},getCustomHeight:function(a){return a},resize:function(){if(!Disney.Friends.UI.isVisible(this.crtSlider))return false;var a,b,e,d=this.crtPanel.height();this.crtSlider.parent().css("height",
d.toString()+"px");a=Math.max(this.crtPanel[0].scrollHeight,this.crtPanel[0].clientHeight)-d;this.totalScroll=a=this.getCustomHeight(a);b=this.sliderMax;if(a+d>0)b=Math.round(this.sliderMax*d/(a+d));a=this.crtSlider.parent().height();b=Math.round((a-50)*b/(2*this.sliderMax))*2;if(b<this.handleHeightMin-8)b=this.handleHeightMin-8;e=b/2;$(this.crtSlider).prev().css("height",(4+e).toString()+"px");$(this.crtSlider).next().css("height",(4+e).toString()+"px");b=a-2*e-50;if(b<=0)b=1;$(this.crtSlider).css("height",
b.toString()+"px").css("top",(e+25).toString()+"px");$(this.crtHandle).children().each(function(){var f=(e-7).toString()+"px";$(this).css("height",f);$(this).hasClass("D_F_SliderHandleMTop")?$(this).css("top","-"+f):$(this).css("bottom","-"+f)})},show:function(){this.crtSlider.parent().show()},hide:function(){this.crtSlider.parent().hide()}};Disney.Friends.UI.Friends={SECTION_HEIGHT:360,TILE_WIDTH:100,TILE_HEIGHT:128,BEST_FRIEND:"BF_",BEST_CHARACTER:"BC_",CHARACTER:"C_",FRIEND:"F_",START_IGLOO_ROOM_ID:2E3,oldScrollTop:null,arrAllFriends:[],crtSwid:null,swids:[],grid:{},columns:2,init:function(){var a=Disney.Friends.Presence.Status,b=Disney.Friends.Event,c=Disney.Social.Event,d=Disney.Friends.UI.Event,e;$("#D_F_FriendsPanel").data();Disney.Friends.UI.frameIt("D_F_FriendSection","D_F_Box25Template",180,this.SECTION_HEIGHT,"0");Disney.Friends.UI.frameIt("D_F_FriendSectionReconnect",
"D_F_Box25Template",180,this.SECTION_HEIGHT,"1");this.groupNames=[this.BEST_FRIEND+a.ONLINE,this.BEST_CHARACTER+a.ONLINE,this.CHARACTER+a.ONLINE,this.FRIEND+a.ONLINE,this.BEST_FRIEND+a.OFFLINE,this.BEST_CHARACTER+a.OFFLINE,this.FRIEND+a.OFFLINE,this.CHARACTER+a.OFFLINE];this.groupArrays=[];e=this.groupNames.length;for(a=0;a<e;a++)this.groupArrays.push([]);this.gridInit();this.gridFill();this.listSlider=Object.create(Disney.Friends.UI.Slider);this.listSlider.init("D_F_FriendsPanel",20,-16,3*this.TILE_HEIGHT,
0,100);this.listSlider.crtFadingUp=$("#D_F_FriendsGridFadeUp");this.listSlider.crtFadingDn=$("#D_F_FriendsGridFadeDn");this.listSlider.getCustomTop=this.getCustomTop;this.listSlider.getCustomHeight=this.getCustomHeight;this.listSlider.onMousewheel=this.onMousewheel;$(this.listSlider.crtSlider.parent()).mousedown(function(){Disney.Friends.UI.ContextNotification.cancel()});b.addListener(b.FRIENDS_UPDATE,this.updateList.bind(this));b.addListener(b.FRIENDS_WEIGHT_UPDATE,this.updatePriority.bind(this));
b.addListener(b.FRIENDS_NEW,this.updateNew.bind(this));b.addListener(b.FRIENDS_REMOVE,this.removeFriend.bind(this));b.addListener(b.SAFE_CHAT_CONNECTION_UPDATE,this.safeChatConnectionUpdate.bind(this));c.addListener(c.ROOM_UPDATE,this.roomUpdate.bind(this));b.addListener(b.JUMP_STATUS_FOR_ROOMS_UPDATE,this.updateJumpStatus.bind(this));d.addListener(d.SUBPANEL_TOGGLED,this.resize.bind(this))},getCustomTop:function(a,b){var c=Disney.Friends.UI.Friends,d=Disney.Friends.UI.Friends.TILE_HEIGHT,e=c.getIndexAllFriends(),
h=3*Math.floor(a/d),f=c.getIndexAllFriendsMax();if(h>f)h=f;c.crtSwid=c.arrAllFriends[h];e!==h&&c.updateGrid();if(b===this.sliderMax)a=0;else if(b===this.sliderMin)a=d;else a%=d;return a},getIndexAllFriendsMax:function(){var a=3*(Math.ceil(this.arrAllFriends.length/3)-4);if(a<0)a=0;return a},getIndexAllFriends:function(){var a,b=0;if(this.arrAllFriends.length===0){this.crtSwid=null;return b}a=this.columns;if(this.crtSwid){b=this.arrAllFriends.indexOf(this.crtSwid);if(b<0)b=0;else{if(a>0)b=a*Math.floor(b/
a);a=this.getIndexAllFriendsMax();if(b>a)b=a}}this.crtSwid=this.arrAllFriends[b];return b},checkIndexAllFriends:function(a){if(this.bestSwid)return false;var b;if(a===this.crtSwid){a=this.arrAllFriends.indexOf(a)+1;b=3*(Math.ceil(this.arrAllFriends.length-1/3)-3);if(b<0)b=0;if(a>b)a=b;this.crtSwid=this.arrAllFriends[a]}},getCustomHeight:function(a){a=Disney.Friends.UI.Friends;var b=a.TILE_HEIGHT,c=this.sliderMin;a=Math.ceil(a.arrAllFriends.length/3)*b-3*b;if(a<0)a=0;if(a>0)c=Math.ceil(this.sliderMax*
b/a);if(c<1)c=1;if(c>this.sliderMax)c=this.sliderMax;this.sliderStep=c;return a},onMousewheel:function(){Disney.Friends.UI.ContextNotification.cancel()},roomUpdate:function(){var a=$("#D_F_FriendsPanel");a.find(".D_F_FriendRoom").each(function(){var b=Disney.Friends.UI.Friends.getSwidByTileId($(this).parent().parent().attr("id"));if(b=a.data(b))(b=b.roomID)&&Disney.Social.Data.rooms&&Disney.Social.Data.rooms[b]&&$(this).text(Disney.Social.Data.rooms[b].short_name)})},safeChatConnectionUpdate:function(a){var b=
$("#D_F_FriendsPanel");b.find(".D_F_FriendName").each(function(){var c=$(this).siblings("input[type=hidden]").val(),d=$(this).siblings(".D_F_FriendPName")[0];c=b.data(c);if(c!==undefined){var e=c.name;if(e!==undefined&&e!==null){if(a===true&&c.safeChatName!==null)if(d)$(d).text("("+c.safeChatName+")");else e+=" ("+c.safeChatName+")";$(this).text(e)}}})},meUpdate:function(){$(".D_F_FriendJump").each(function(){$(this).hasClass("D_F_JumpTemplate")||Disney.Friends.UI.Friends.updateJump(this)});Disney.Friends.UI.HudNotification.reStyleBubble()},
updateJumpStatus:function(){Disney.Friends.UI.Friends.meUpdate()},gridInit:function(){for(var a=0;a<4;a++)for(var b=0;b<3;b++){$("#D_F_FriendsGrid").append($("#D_F_TileTemplate > div").clone(true));var c="D_F_Tile_"+a.toString()+b.toString();$("#D_F_FriendsGrid").children(":last").attr("id",c).addClass("D_F_Tile_R"+a.toString()).addClass("D_F_Tile_C"+b.toString())}},gridFill:function(){var a,b,c,d;for(a=0;a<4;a++)for(b=0;b<3;b++){this.grid[a]||(this.grid[a]={});this.grid[a][b]||(this.grid[a][b]={});
this.grid[a][b].swid=null}d=this.swids.length;for(a=0;a<d;a++){b=this.swids[a];c=this.getCoordByIndex(a);this.grid[c[0]][c[1]].swid=b}this.gridPaint()},resize:function(){var a,b,c;c=2;var d,e=0;a=0;d=this.arrAllFriends.length;if(d>5)c=3;a=this.SECTION_HEIGHT;b=parseInt($("#D_F_FriendSection").css("height"),10);if(d===5||d>6)a+=44;if($("#D_F_AddFriendPanel").css("display")!=="none")a+=25;if($("#D_F_NotificationPanel").css("display")!=="none")a+=20;if(c!==this.columns){e=(c-this.columns)*this.TILE_WIDTH;
this.columns=c;$("#D_F_FriendsPanel").width(c*this.TILE_WIDTH)}c=this.listSlider.crtSlider.parent();if(d>9){$("#D_F_FriendsPanel").css("left","-13px");$(".D_F_FriendFavorite").show();this.listSlider.bindMousewheel();if($(c).css("display")==="none"){$(c).show();e+=parseInt($(c).css("width"),10)-10}a+=3}else{$("#D_F_FriendsPanel").css("left","-10px");Disney.Friends.UI.bestEnabled?$(".D_F_FriendFavorite").show():$(".D_F_FriendFavorite").css("display","none");this.listSlider.unbindMousewheel();this.listSlider.scrollToTop();
if($(c).css("display")!=="none"){e-=parseInt($(c).css("width"),10)-10;$(c).hide()}}a=a-b;if(e||a)Disney.Friends.UI.resizeFriendsWidgetWith(e,a)},gridPaint:function(){var a,b,c,d,e,h=$("#D_F_FriendsGrid").detach();for(a=0;a<4;a++)for(b=0;b<3;b++)if(c=this.getTileIdByCoord(a,b))if(c=h.find("#"+c))if(d=this.grid[a][b].swid){e=$(c).find(".D_F_FriendAvatar")[0];if(e===undefined){Disney.Social.unbindAll(c);$(c).empty().append($("#D_F_FriendTileTemplate > *").clone(true));e=$(c).find(".D_F_JumpTemplate")[0];
$(e).removeClass("D_F_JumpTemplate")}this.displayTile(c,d)}else if(a<3){e=$(c).find(".D_F_AddFriendBtn")[0];if(e===undefined&&this.arrAllFriends.length<9){Disney.Social.unbindAll(c);$(c).empty().append($("#D_F_AddTileTemplate > *").clone(true))}}else{Disney.Social.unbindAll(c);$(c).empty()}h.appendTo("#D_F_FriendsPanel");$("#D_F_FriendsPanel").scrollTop(0)},updateArrays:function(){var a=Disney.Friends.UI.Event,b,c,d;c=this.arrAllFriends.length;this.arrAllFriends.length=0;d=this.groupArrays.length;
for(b=0;b<d;b++)this.parseFriendsArr(this.groupArrays[b]);b=this.arrAllFriends.length;c!==b&&a.updateListeners(a.FRIENDS_COUNT,b);this.updateGrid();this.bestSwid=null;if(this.arrAllFriends.length>9){Disney.Friends.UI.ContextNotification.showBestHint();this.listSlider.resize();$("#D_F_HeaderFriendsCount").text("("+this.arrAllFriends.length.toString()+")").show();a=Math.ceil(this.arrAllFriends.length/3);c=Math.ceil(this.getIndexAllFriends()/3);b=this.listSlider.sliderMax;a=b-Math.round(b*c/a);this.listSlider.crtSlider.slider("value",
a)}else $("#D_F_HeaderFriendsCount").css("display","none");Disney.Friends.UI.Images.preloadAvatars()},parseFriendsArr:function(a){var b,c,d=a.length;for(b=0;b<d;b++){c=a[b].swid;this.arrAllFriends.push(c)}},updateGrid:function(){var a,b;if($("#D_F_FriendSection").css("display")==="none")return false;this.swids.length=0;a=this.getIndexAllFriends();b=this.arrAllFriends.length;for(a=a;a<b;a++){this.swidsAdd(this.arrAllFriends[a]);if(this.swids.length===12)break}this.gridFill()},swidsAdd:function(a){if(!a)return false;
if(this.swids.length>11)return false;if(this.swids.indexOf(a)>=0)return false;this.swids.push(a);return true},getSwidIndex:function(a,b){for(var c=b.length;c--;)if(b[c].swid===a)return c;return-1},getTileIdByCoord:function(a,b){return"D_F_Tile_"+a.toString()+b.toString()},getTileIdBySwid:function(a){a=this.swids.indexOf(a);if(a<0)return null;a=this.getCoordByIndex(a);if(!a)return null;return this.getTileIdByCoord(a[0],a[1])},getGroupIndexBySwid:function(a){var b,c,d=this.groupArrays.length;for(b=
0;b<d;b++){c=this.getSwidIndex(a,this.groupArrays[b]);if(c>-1)return[b,c]}return[-1,-1]},getCoordByIndex:function(a){if(!this.columns||a<0||a>11)return null;return[Math.floor(a/this.columns),(a+this.columns)%this.columns]},getSwidByTileId:function(a){var b=null,c=a.lastIndexOf("_"),d=a.substr(c+1,1);a=a.substr(c+2,1);if(this.grid[d]&&this.grid[d][a])b=this.grid[d][a].swid;return b},displayTile:function(a,b){var c=Disney.Friends.Presence.Status,d=Disney.Friends.UI.Images,e=this.getGroupIndexBySwid(b),
h=$("#D_F_FriendsPanel").data(b);if(!h)return false;var f=h.Id,g=h.name;h=h.status;var j,i,k;$(a).children("input[type=hidden]").val(b);if((j=$(a).find(".D_F_PlayerCard")[0])&&b.indexOf("character_")===0){Disney.Friends.UI.FriendsTile.bindCharacterCard(j);if(Disney.Social.Data.mascots&&Disney.Social.Data.mascots[f])g=Disney.Social.Data.mascots[f].name}j||$(a).find(".D_F_CharacterCard");i=$(a).find(".D_F_FriendAvatar")[0];k=$(a).find(".D_F_FriendAvatarOff")[0];f=$(a).find(".D_F_FriendFavorite")[0];
j=$(a).find(".D_F_FriendName")[0];Disney.Friends.UI.getAvatarUriBySwid(i,b,88,true);h===c.ONLINE?$(k).css("display","none"):$(k).show();$(i).show();c=this.groupNames[e[0]];if(c.substr(0,this.BEST_FRIEND.length)===this.BEST_FRIEND||c.substr(0,this.BEST_CHARACTER.length)===this.BEST_CHARACTER){d.setAttrs(f,"20",false);$(f).attr("title",Disney.Friends.UI.setText("D7"))}else{d.setAttrs(f,"22",false);$(f).attr("title",Disney.Friends.UI.setText("D10"))}j!==undefined&&j!==null&&$(j).text(g);this.updateJump($(a).find(".D_F_FriendJump")[0])},
updateJump:function(a,b){if(!a)return false;$(a).css("cursor","default").unbind("mousedown");var c=Disney.Friends.Presence.Status,d=Disney.Friends.UI.Me,e=Disney.Social.Data,h=Disney.Friends.UI.Friends,f,g,j,i;i=$(a).siblings("input[type=hidden]").val();if(!i)return false;f=$("#D_F_FriendsPanel").data(i);if(!f){f={status:c.OFFLINE,roomID:null,worldID:null};if(b){f.status=c.ONLINE;f.roomID=b.location.room;f.worldID=b.location.world}}g=f.status;if(j=$(a).siblings(".D_F_FriendStatus")[0])g===c.ONLINE?
$(j).css("display","none"):$(j).show();if(g!==c.ONLINE){$(a).css("display","none");return false}$(a).css("display","none");c=$(a).find(".D_F_FriendJumpBtn")[0];$(c).css("display","none");g=$(a).find(".D_F_FriendRoom")[0];$(g).text("").css("display","none");if(i.indexOf("character_")===0&&!b)return false;if((i=f.roomID)&&e.rooms&&e.rooms[i]){$(a).show();$(g).text(e.rooms[i].short_name).css("left","15px").css("color","#6DABD7").css("display","block")}else if(i>this.START_IGLOO_ROOM_ID){$(a).show();
$(g).text(Disney.Friends.UI.setText("D22")).css("left","15px").css("color","#6DABD7").css("display","block")}else return false;e=f.worldID;if(!e||i===d.roomId&&e===d.worldId)return false;if(!b&&!Disney.Friends.Jump.canJump(e,i))return false;h.bindJump(a);$(a).css("cursor","pointer");$(g).css("left","5px").css("color","white");$(c).show()},bindJump:function(a){$(a).mousedown(function(b){Disney.Social.stopEvent(b);Disney.Friends.UI.HudNotification.close();b=$(this).siblings("input[type=hidden]").val();
if(b.indexOf("character_")===0){Disney.Friends.UI.jumpToCharacter(Disney.Friends.UI.HudNotification.characterPresences[b]);Disney.Analysis.loggingEvent(Disney.Metrics.Type.CHARACTER_INVITE_ACCEPTED,b)}else Disney.Friends.UI.jumpToFriend(b)})},updatePriority:function(a){var b,c,d,e;for(b in a)if(a.hasOwnProperty(b))if(a[b].weight&&$("#D_F_FriendsPanel").data(b))$("#D_F_FriendsPanel").data(b).weight=a[b].weight;e=this.groupArrays.length;for(a=0;a<e;a++){b=this.groupArrays[a];d=b.length;for(c=0;c<d;c++)b[c].weight=
$("#D_F_FriendsPanel").data(b[c].swid).weight;this.sortListByWeight(a)}this.updateArrays()},updateTile:function(a){if($("#D_F_FriendSection").css("display")==="none")return false;var b=this.getTileIdBySwid(a);if(!b)return false;$("#D_F_FriendsPanel").data(a)!==undefined&&$("#D_F_FriendsPanel").data(a)!==null&&this.displayTile($("#"+b),a)},sortNames:function(a,b){if(!a.name)return 1;if(!b.name)return-1;return a.name.toLocaleUpperCase().localeCompare(b.name.toLocaleUpperCase())},sortWeights:function(a,
b){return a.weight!==b.weight?a.weight>b.weight?-1:1:0},updateNew:function(a){this.oldScrollTop=null;var b,c,d;if(a.hasOwnProperty("swid")){c=a.swid;d=a.name;b=this.processSingleEntry(c,a);this.sortAffected(b);this.updateArrays(c)}this.updateWidget();b=Disney.Friends.UI.HudNotification;b.notify(d,b.FRIEND_ACCEPTANCE,c);Disney.Friends.UI.BarNotification.newFriendCallback(a)},updateList:function(a){this.oldScrollTop=null;var b,c;if(a.hasOwnProperty("character")){b=a.id.toString();a=this.processSingleEntry(b,
a);b="character_"+b;this.sortAffected(a);a.length===0?this.updateTile(b):this.updateArrays()}else if(a.hasOwnProperty("swid")){b=a.swid;a=this.processSingleEntry(b,a);this.sortAffected(a);a.length===0?this.updateTile(b):this.updateArrays()}else{for(c in a)a.hasOwnProperty(c)&&this.processSingleEntry(c,a[c]);a=[];len=this.groupArrays.length;for(c=0;c<len;c++)a[c]=c;this.sortAffected(a);this.updateArrays()}this.updateWidget();Disney.Friends.UI.AddFriend.updateSearchTile(b)},updateWidget:function(){this.arrAllFriends.length>
9&&this.listSlider.resize()},sortAffected:function(a){var b,c=a.length;for(b=0;b<c;b++){this.sortListByName(a[b]);this.sortListByWeight(a[b])}},sortListByName:function(a){this.groupArrays[a].sort(this.sortNames)},sortListByWeight:function(a){this.groupArrays[a].sort(this.sortWeights)},processSingleEntry:function(a,b){var c=[],d=null,e=null,h=null,f=0,g=null,j=null,i=null;if(b.hasOwnProperty("character")){a="character_"+a;if(b.id!==undefined&&b.id!==null)d=b.id;c=c[0]!==undefined&&c[0]!==null&&c[0]===
1?this.BEST_CHARACTER:this.CHARACTER}else{if(b.groups!==undefined&&b.groups!==null)c=b.groups;c=c[0]!==undefined&&c[0]!==null&&c[0]===1?this.BEST_FRIEND:this.FRIEND;if(b.presence.id!==undefined&&b.presence.id!==null)d=b.presence.id}if(b.name!==undefined&&b.name!==null)e=$.trim(b.name);if(b.safeChatName!==undefined&&b.safeChatName!==null)h=$.trim(b.safeChatName);if(b.weight!==undefined&&b.weight!==null)f=b.weight;if(b.presence.status!==undefined&&b.presence.status!==null)g=b.presence.status;if(b.presence.location!==
undefined&&b.presence.location!==null){if(b.presence.location.world!==undefined&&b.presence.location.world!==null&&b.presence.location.world!=="")j=b.presence.location.world;if(b.presence.location.room!==undefined&&b.presence.location.room!==null&&b.presence.location.room!=="")i=b.presence.location.room}var k=Disney.Friends.UI.HudNotification,m=Disney.Friends.Presence.Status,o="",l,n;if($("#D_F_FriendsPanel").data(a)!==undefined&&$("#D_F_FriendsPanel").data(a)!==null){o=$("#D_F_FriendsPanel").data(a).status;
l=$("#D_F_FriendsPanel").data(a).type;$("#D_F_FriendsPanel").data(a);n=$("#D_F_FriendsPanel").data(a).cache}if((c===this.BEST_FRIEND||c===this.BEST_CHARACTER)&&l!==undefined&&l!==this.BEST_FRIEND&&l!==this.BEST_CHARACTER)this.crtSwid=this.bestSwid=a;$("#D_F_FriendsPanel").data(a,{type:c,Id:d,name:e,safeChatName:h,weight:f,status:g,worldID:j,roomID:i});if(g!==m.ONLINE)$("#D_F_FriendsPanel").data(a).cache={};else if(n)$("#D_F_FriendsPanel").data(a).cache=n;if(g===m.ONLINE&&o===m.OFFLINE){Disney.Friends.UI.Images.setAvatarCache(a,
88,false);c===this.BEST_CHARACTER||c===this.CHARACTER?k.notify(e,k.CHARACTER_ONLINE,a):k.notify(e,k.FRIEND_ONLINE,a)}d=this.getGroupIndexBySwid(a);g=this.groupNames.indexOf(c+g);if(d[0]===g){this.groupArrays[d[0]][d[1]]={name:e,weight:f,swid:a};return[]}else{if(d[0]>-1){this.checkIndexAllFriends(a);this.groupArrays[d[0]].splice(d[1],1)}this.groupArrays[g].push({name:e,weight:f,swid:a});return[g]}},removeFriend:function(a){if(parseInt(a,10)>0)a="character_"+a;$("#D_F_FriendsPanel").data(a,null);$("#D_F_FriendsPanel").removeData(a);
this.checkIndexAllFriends(a);a=this.getGroupIndexBySwid(a);this.groupArrays[a[0]].splice(a[1],1);this.updateArrays()}};Disney.Friends.UI.FriendsTile={friendGroups:{swid:null,groups:[]},init:function(){$(".D_F_PlayerCard").mousedown(function(a){Disney.Social.stopEvent(a);Disney.Friends.UI.FriendsTile.showPlayerCard(this)});$(".D_F_FriendFavorite").mousedown(function(a){Disney.Social.stopEvent(a);Disney.Friends.UI.FriendsTile.toggleBest(this)});$(".D_F_AddFriendBtn").mousedown(function(a){Disney.Social.stopEvent(a);Disney.Friends.UI.AddFriend.showAddFriend(this)})},showPlayerCard:function(a){a=$(a).siblings("input[type=hidden]").val();
Disney.Friends.UI.showPlayerCard(a)},bindCharacterCard:function(a){$(a).unbind("mousedown").addClass("D_F_CharacterCard").removeClass("D_F_PlayerCard").mousedown(function(b){Disney.Social.stopEvent(b);Disney.Friends.UI.FriendsTile.showCharacterCard(this)})},showCharacterCard:function(a){a=$(a).siblings("input[type=hidden]").val();a=a.substr(a.lastIndexOf("_")+1);Disney.Friends.API.showCharacterCard(a)},toggleBest:function(a){a=$(a).siblings("input[type=hidden]").val();Disney.Friends.UI.setBestFriend(a)}};Disney.Friends.UI.Pending={sortedList:[],init:function(){var a=Disney.Friends.Event;a.addListener(a.PENDING_UPDATE,this.update.bind(this));a.addListener(a.PENDING_REMOVE,this.remove.bind(this))},update:function(a){var b,c,d=Disney.Friends.UI.Event;if(!a||!a.swid)return false;b=a.swid;c=$.trim(a.name);if(!c)return false;this.sortedList.push({name:c,swid:b});this.sortedList.sort(Disney.Friends.UI.Friends.sortNames);d.updateListeners(d.PENDINGS_UPDATED,a)},accept:function(a){var b=Disney.Friends.UI.Event;
if(!a)return false;Disney.Friends.API.acceptFriendship(a);b.updateListeners(b.PENDING_ACCEPTED,a)},reject:function(a){var b=Disney.Friends,c=b.UI.Event;if(!a)return false;a&&b.activeUser&&b.activeUser.roster.pending[a]&&Disney.Friends.API.rejectFriendship(a);c.updateListeners(c.PENDING_REJECTED,a)},remove:function(a){var b,c=Disney.Friends.UI.Pending,d=Disney.Friends.UI.Event;if(!a)return false;b=Disney.Friends.UI.Friends.getSwidIndex(a,c.sortedList);b>-1&&c.sortedList.splice(b,1);d.updateListeners(d.PENDING_REMOVED,
a)}};Disney.Friends.UI.BarNotification={state:null,states:{CLOSED:"closed",OPEN:"open",ANIMATING:"animating"},scroller:null,dragging:false,dragStartTime:null,dragStartState:null,dragStartPosition:null,dragMinimum:300,animationSpeed:300,maxHeight:176,largeMaxHeight:176,largeHalfHeight:102,smallMaxHeight:150,timeoutDuration:2E4,timeouts:[],newFriendAnimationFrames:{3:2,4:2,5:2,6:2,7:2,8:2,14:2,15:2,16:2,17:2,18:2,19:2,20:2,21:2,22:2,23:2,24:2,25:2,26:3,27:2,29:2},pendingAccept:false,init:function(){this.state=
this.states.CLOSED;this.scroller=Object.create(Disney.Friends.UI.Slider);this.scroller.init("D_F_Notifications",20,0,130,0,100);this.scroller.bindMousewheel();this.friendsCount=Disney.Friends.UI.Friends.arrAllFriends.length;var a=Disney.Friends.UI.Event;a.addListener(a.FRIENDS_COUNT,this.friendsCountUpdate.bind(this));a.addListener(a.PENDINGS_UPDATED,this.pendingUpdateCallback.bind(this));a.addListener(a.PENDING_ACCEPTED,this.friendshipAccepted.bind(this));a.addListener(a.PENDING_REJECTED,this.friendshipRejected.bind(this));
a.addListener(a.PENDING_REMOVED,this.pendingRemoveCallback.bind(this));$("#D_F_NotificationHandleHolder").mousedown(this.startDragCallback)},friendsCountUpdate:function(a){this.friendsCount=a;this.togglePanel(true);this.resizeHeight();$("#D_F_NotificationPanel").height(this.maxHeight);$("#D_F_Notifications").height(this.maxHeight-24)},update:function(){this.state=this.states.OPEN;this.checkScroller();setTimeout(this.showQueuedAccept,300)},togglePanel:function(a){this.resize();if(a&&$("#D_F_Notifications").children().length){this.showQueuedAccept();
$("#D_F_NotificationPanel").show();this.state=this.states.OPEN;this.hideCount()}else{$("#D_F_NotificationPanel").hide();this.state=this.states.CLOSED;this.showCount()}this.updateHandle();a=Disney.Friends.UI.Event;a.updateListeners(a.SUBPANEL_TOGGLED)},togglePanelCallback:function(a,b){var c=Disney.Friends.UI.BarNotification;a&&Disney.Social.stopEvent(a);if(b)c.state=b===c.states.CLOSED?c.states.OPEN:c.states.CLOSED;switch(c.state){case c.states.CLOSED:c.togglePanel(true);c.hideCount();$("#D_F_NotificationPanel").animate({height:c.maxHeight+
"px"},c.animationSpeed,function(){c.state=c.states.OPEN;c.updateHandle()});c.state=c.states.ANIMATING;break;case c.states.OPEN:$("#D_F_NotificationPanel").animate({height:"20px"},c.animationSpeed,function(){c.state=c.states.CLOSED;c.updateHandle();c.showCount();$("#D_F_Notifications").children().length||c.togglePanel(false)});c.state=c.states.ANIMATING}},updateHandle:function(){var a=44;if(this.state===this.states.OPEN)a=38;Disney.Friends.UI.Images.setAttrs($("#D_F_NotificationHandle"),a)},showCount:function(){var a=
$("#D_F_Notifications .D_F_FriendNotification").length;if(a){$("#D_F_NotificationCountText").html(a);$("#D_F_NotificationCount, #D_F_NotificationCountText").css("display","block")}else this.hideCount()},hideCount:function(){$("#D_F_NotificationCount, #D_F_NotificationCountText").css("display","none")},checkHidingPanel:function(){$("#D_F_Notifications").children().length||this.togglePanelCallback(null,this.states.CLOSED)},checkBarHeight:function(a,b){var c=$("#D_F_Notifications").height();this.resizeHeight();
if(this.state===this.states.CLOSED&&b!==true||c===this.maxHeight-24){$("#D_F_NotificationPanel").height(this.maxHeight);$("#D_F_Notifications").height(this.maxHeight-24);a()}else{$("#D_F_NotificationPanel").animate({height:this.maxHeight},this.animationSpeed,a);$("#D_F_Notifications").animate({height:this.maxHeight-24},this.animationSpeed)}this.resizeActions()},resizeHeight:function(){this.maxHeight=$("#D_F_NotificationPanel").hasClass("D_F_FriendNotificationBgL")?$("#D_F_Notifications").children().length>
1||$("#D_F_Notifications").find(".D_F_FriendNotificationAccept").length?this.largeMaxHeight:this.largeHalfHeight:this.smallMaxHeight},pendingUpdateCallback:function(a){var b=Disney.Friends.UI.BarNotification,c=Disney.Friends.UI,d=a.swid;if($("#D_F_Notifications").find("input[value='"+d+"']").length)return false;var e=$("#D_F_FriendNotificationTemplate").contents().clone(true);e.find("input").val(d);e.find(".D_F_FriendNotificationName").html(a.name);e.find(".D_F_FriendNotificationMessage").html(Disney.Friends.UI.setText("D6"));
c.getAvatarUriBySwid(e.find(".D_F_FriendNotificationAvatar"),d,60,false);e.find(".D_F_FriendNotificationAvatar").click(function(){Disney.Friends.UI.showPlayerCard(d)});e.find(".D_F_FriendNotificationAdd").click(function(){Disney.Friends.UI.Pending.accept(d)});e.find(".D_F_FriendNotificationDeny").click(function(){b.queue("Deny"+d,Disney.Friends.UI.Pending.reject,[e,d],b.timeoutDuration);Disney.Friends.UI.Pending.reject(d)});$("#D_F_Notifications").append(e);$("#D_F_Notifications").children().length>
1?b.checkScroller(true):this.scroller.hide();b.state===b.states.CLOSED&&b.togglePanelCallback(null,b.states.OPEN);this.resizeActions()},pendingRemoveCallback:function(a){this.dequeue("Deny"+a)},newFriendCallback:function(a){var b=Disney.Friends.UI.BarNotification,c=$("#D_F_Notifications"),d=Disney.Friends.UI;c=c.find(".D_F_FriendNotificationAccept");var e=a.name;a=a.swid;a=$("#D_F_Notifications").find("input[value='"+a+"']");a.length&&b.removeNotification(a.parents(".D_F_FriendNotification"));if(c.length){e=
parseInt(c.data("count"),10);c.find(".D_F_FriendNotificationAcceptName").html(++e+" "+d.setText("D21"));c.data("count",e)}else{c=$("#D_F_FriendNotificationAcceptTemplate").contents().clone(true);c.find(".D_F_FriendNotificationAcceptName").html(e);c.data("count",1);b.checkBarHeight(function(){b.scroller.scrollToTop();b.togglePanelCallback(null,b.states.OPEN);b.pendingAccept=true;$("#D_F_FriendsPanel:visible").length&&b.showQueuedAccept()},true)}},showQueuedAccept:function(){if($("#D_F_FriendsPanel:visible").length!==
0){var a=Disney.Friends.UI.BarNotification,b=$("#D_F_Notifications .D_F_FriendNotificationAccept");if(a.pendingAccept){a.pendingAccept=false;b.length&&b.slideDown(function(){b.css("visibility","visible").hide().fadeIn(function(){Disney.Friends.UI.animateSprite("#D_F_NotificationAnimation",80,29,a.newFriendAnimationFrames,10,function(){b.empty();a.removeNotification(b)})})})}}},friendshipAccepted:function(a){this.removeNotification($("#D_F_Notifications").find("input[value='"+a+"']").parents(".D_F_FriendNotification"))},
friendshipRejected:function(a){this.removeNotification($("#D_F_Notifications").find("input[value='"+a+"']").parents(".D_F_FriendNotification"))},removeNotification:function(a,b,c){b?setTimeout(function(){Disney.Friends.UI.BarNotification.removeNotification(a)},b):a.fadeOut(function(){Disney.Social.unbindAll(a);a.show().css("visibility","hidden");a.slideUp(function(){a.remove();Disney.Friends.UI.BarNotification.checkScroller();c||Disney.Friends.UI.BarNotification.checkHidingPanel()})})},checkScroller:function(a){this.resize();
this.checkBarHeight(function(){var b=Disney.Friends.UI.BarNotification.scroller,c=$("#D_F_Notifications").children().length;if(c>2||c>1&&$("#D_F_NotificationPanel").hasClass("D_F_FriendNotificationBgS")){$("#D_F_NotificationPanel").addClass("D_F_FriendNotificationWithScroller");b.show();b.resize();b.scrollToTop()}else{$("#D_F_NotificationPanel").removeClass("D_F_FriendNotificationWithScroller");b.hide()}},a)},resize:function(){if(this.friendsCount<9&&this.friendsCount>5)$("#D_F_NotificationPanel").css("bottom",
"-5px").removeClass("D_F_FriendNotificationBgS").addClass("D_F_FriendNotificationBgL");else this.friendsCount>8?$("#D_F_NotificationPanel").css("bottom","20px").removeClass("D_F_FriendNotificationBgS").addClass("D_F_FriendNotificationBgL"):$("#D_F_NotificationPanel").css("bottom","-5px").removeClass("D_F_FriendNotificationBgL").addClass("D_F_FriendNotificationBgS");$("#D_F_NotificationPanel").css("width",($("#D_F_FriendSection").width()+32).toString()+"px");this.scroller.resize();this.resizeActions()},
resizeActions:function(){var a,b;if((b=$("#D_F_Notifications").find(".D_F_FriendNotificationYN")[0])&&Disney.Friends.UI.isVisible($(b))){a=$(b).children(":first").width();a+=$(b).children(":last").width();a+=30;$(".D_F_FriendNotificationYN").css("width",a.toString()+"px").css("margin","0 auto");b=$(b).parent().parent().width()-5;$("#D_F_NotificationPanel").hasClass("D_F_FriendNotificationBgL")?$(".D_F_FriendNotificationYN").parent().css("width",a.toString()+"px"):$(".D_F_FriendNotificationYN").parent().css("width",
b.toString()+"px")}},startDragCallback:function(a){var b=Disney.Friends.UI.BarNotification;Disney.Social.stopEvent(a);b.dragStartState=b.state;b.dragStartTime=(new Date).getTime();b.dragging=true;b.dragStartPosition={x:a.pageX,y:a.pageY};$(document).mouseup(b.endDragCallback);$(document).mousemove(b.dragCallback)},dragCallback:function(a){Disney.Social.stopEvent(a);var b=Disney.Friends.UI.BarNotification,c=b.dragStartPosition.y;a=a.pageY;c=b.dragStartState===b.states.OPEN?a-c:c-a;if(c<=b.maxHeight-
20&&c>=0)b.dragStartState===b.states.OPEN?$("#D_F_NotificationPanel").css("height",(b.maxHeight-c).toString()+"px"):$("#D_F_NotificationPanel").css("height",(c+20).toString()+"px")},endDragCallback:function(a){var b=Disney.Friends.UI.BarNotification,c=(new Date).getTime();if(b.dragging&&b.dragStartTime<c-b.dragMinimum){c=b.dragStartPosition.y-a.pageY>$("#D_F_Notifications").height()/2;a=a.pageY-b.dragStartPosition.y>$("#D_F_Notifications").height()/2;if(b.dragStartState===b.states.CLOSED&&c||b.dragStartState===
b.states.OPEN&&!a)b.togglePanelCallback(null,b.states.OPEN);else if(b.dragStartState===b.states.CLOSED||b.dragStartState===b.states.OPEN&&a)b.togglePanelCallback(null,b.states.CLOSED)}else b.togglePanelCallback(a);b.dragging=false;b.startDragTime=null;b.startDragState=null;$(document).unbind("mouseup",b.endDragCallback);$(document).unbind("mousemove",b.dragCallback)},queue:function(a,b,c,d){d=setTimeout(function(){b.apply(Disney.Friends.UI.BarNotification,c)},d);this.timeouts.push({key:a,timeout:d})},
dequeue:function(a){this.timeouts=$.grep(this.timeouts,function(b){if(b.key===a){clearTimeout(b.timeout);return false}return true})}};Disney.Friends.UI.AddFriend={searchName:"",currentFilter:"",filterCount:0,filterStep:200,filterDelay:50,filterTimeout:null,ctrlDown:false,friendRequestAnimationFrames:{1:9,17:2,18:8,19:2},modes:{STANDALONE:1,FULL:2},init:function(){Disney.Friends.UI.frameIt20("D_F_AddFriendExpanded","D_F_Box20Template",164,150);this.scroller=Object.create(Disney.Friends.UI.Slider);this.scroller.init("D_F_AddFriendGrid",15,-15,110,0,100);this.scroller.bindMousewheel();this.friendsCount=Disney.Friends.UI.Friends.arrAllFriends.length;
var a=Disney.Friends.Event;a.addListener(a.FOUND_PLAYER,this.foundPlayer.bind(this));a.addListener(a.FIND_PLAYER_EXISTING_FRIEND,this.foundPlayerExisting.bind(this));a.addListener(a.FIND_PLAYER_EXISTING_IGNORE,this.foundPlayerIgnored.bind(this));a.addListener(a.FIND_PLAYER_NOT_FOUND,this.playerNotFound.bind(this));a=Disney.Friends.UI.Event;a.addListener(a.FRIENDS_COUNT,this.friendsCountUpdate.bind(this));$("#D_F_AddFriendClose").mousedown(function(b){Disney.Social.stopEvent(b);Disney.Friends.UI.AddFriend.closePanel()});
$("#D_F_AddFriendFinderFieldDef").mousedown(function(b){Disney.Social.stopEvent(b);Disney.Friends.UI.AddFriend.setFocus()});$(".D_F_AddFriendItem").mousedown(function(b){Disney.Social.stopEvent(b);Disney.Friends.UI.AddFriend.addClick(this)});$("#D_F_AddFriendFinderFind").mousedown(function(b){Disney.Social.stopEvent(b);Disney.Friends.UI.AddFriend.findClick()});$(".D_F_AddFriendFavorite").mousedown(function(b){Disney.Social.stopEvent(b);Disney.Friends.UI.AddFriend.toggleBest(this)});if(typeof document.body.style.MozUserSelect!==
"undefined")$("#D_F_AddFriendFinderField").css("MozUserSelect","text");else if(typeof document.body.style.webkitUserSelect!=="undefined")$("#D_F_AddFriendFinderField").css("webkitUserSelect","text");else if(typeof document.body.onselectstart!=="undefined")document.getElementById("D_F_AddFriendFinderInput").onselectstart=function(){return window.event.cancelBubble=true}},friendsCountUpdate:function(a){this.friendsCount=a;this.togglePanel()},findClick:function(){var a=Disney.Friends.UI.AddFriend;if(a.searching)return false;
var b=a.trimInput();if(b.length<1){a.setFocus();return false}$("#D_F_AddFriendError, #D_F_AddFriendResults, #D_F_AddFriendGrid").css("display","none");a.scroller.hide();$("#D_F_AddFriendFinderField").attr("value",b);a.showExpanded();$("#D_F_AddFriendMessage").css("display","none");$("#D_F_AddFriendBusy").show();a.searching=true;a.findPlayer(b);Disney.Metrics.incrementCounter(Disney.Metrics.Type.ADD_FRIEND,Disney.Metrics.Type.ADD_FRIEND_SEARCHES)},trimInput:function(){return $.trim($("#D_F_AddFriendFinderField").attr("value"))},
setFocus:function(){Disney.Friends.UI.AddFriend.showExpanded();setTimeout(function(){$("#D_F_AddFriendFinderField").focus()},100)},resetPlacehoder:function(){$("#D_F_AddFriendFinderField").attr("value","");$("#D_F_AddFriendFinderFieldDef").show()},addClick:function(a){var b=Disney.Friends.UI.AddFriend;$(a).unbind("mousedown");a=$(a).find("input[type=hidden]").val();Disney.Friends.UI.AddFriend.addRequest(a);a=$('<div id="D_F_AddFriendAnimation" />');Disney.Friends.UI.animateSprite("#D_F_AddFriendAnimation",
100,21,b.friendRequestAnimationFrames,15,function(){var d=Disney.Friends.UI.AddFriend;d.clearFilterResults();$("#D_F_AddFriendResults").css("display","none");$("#D_F_AddFriendGrid").css("display","none");$("#D_F_AddFriendFinderField").val("");d.closePanel()});a.css({top:$("#D_F_AddFriendResults").find(".D_F_AddFriendItem").position().top+10,left:($("#D_F_AddFriendResults").width()-100)/2+10});$("#D_F_AddFriendResults").find(".D_F_AddFriendItem").css("display","none");$("#D_F_AddFriendResults").append(a)},
keyDown:function(a){a=a.which;if(a===17){this.ctrlDown=true;return false}this.searchName=$("#D_F_AddFriendFinderField").attr("value");$("#D_F_AddFriendError").empty().css("display","none");this.ctrlDown&&a===86&&$("#D_F_AddFriendFinderFieldDef").css("display","none");var b=this.trimInput();if(b.length<=1&&(a===8||a===46)||b.length===0&&(a<48||a>110)||this.ctrlDown&&a===8){$("#D_F_AddFriendFinderField").attr("value","");this.clearFilterResults();$("#D_F_AddFriendMessage").show();$("#D_F_AddFriendBusy").css("display",
"none");this.searching=false;return true}$("#D_F_AddFriendFinderFieldDef").css("display","none");if(a===13)$("#D_F_AddFriendFinderFind").mousedown();else{$("#D_F_AddFriendBusy").css("display","none");$("#D_F_AddFriendMessage").show();this.searching=false}this.typingTimeout&&clearTimeout(this.typingTimeout)},keyUp:function(a){a=a.which;if(a===17)return this.ctrlDown=false;a===32&&!this.searchName&&$("#D_F_AddFriendFinderField").attr("value","");a===46&&this.searchName&&$("#D_F_AddFriendFinderField").attr("value",
this.searchName.substr(0,this.searchName.length-1));if(a>110&&a<188||a>190)$("#D_F_AddFriendFinderField").attr("value",this.searchName);if(this.searchName.length===$("#D_F_AddFriendFinderField").attr("value").length)return false;this.searchName=$("#D_F_AddFriendFinderField").attr("value");this.searchName.length>0&&$("#D_F_AddFriendFinderFieldDef").css("display","none");this.typingTimeout&&clearTimeout(this.typingTimeout);if(this.friendsCount>9&&a!==13)this.typingTimeout=setTimeout(function(){Disney.Friends.UI.AddFriend.updateFilter()},
200);else this.clearFilterResults()},updateFilter:function(){this.currentFilter=this.searchName.toLowerCase();this.clearFilterResults();if(this.filterRunning)this.filterUpdated=true;else this.lookupFriends()},stopFilter:function(){var a=Disney.Friends.UI.AddFriend;clearTimeout(a.filterTimeout);a.filterUpdated=false;a.filterRunning=false;a.filterCount=0},lookupFriends:function(){this.filterRunning=true;var a=function(){var b=Disney.Friends.UI.AddFriend,d=[],c=[],e=[],h=b.filterCount,g=true;if(b.filterUpdated){b.stopFilter();
b.clearFilterResults();b.lookupFriends()}else{if(b.currentFilter)for(var m=RegExp("^"+b.currentFilter),j=RegExp(b.currentFilter+"$"),n=RegExp(b.currentFilter),k=Disney.Friends.UI.Friends.arrAllFriends,i=h;i<h+b.filterStep;i++){var f=k[i],l=$("#D_F_FriendsPanel").data(f);if(f===undefined){b.stopFilter();g=false;break}l=l.name.toLowerCase();if(m.test(l)&&$.inArray(f,d)<0)d.push(f);else if(j.test(l)&&$.inArray(f,e)<0)e.push(f);else n.test(l)&&$.inArray(f,c)<0&&c.push(f);b.filterCount=i+1}else{b.stopFilter();
b.clearFilterResults()}b.updateGrid([].concat(d,e,c));if(g)b.filterTimeout=setTimeout(a,b.filterDelay)}};a()},clearFilterResults:function(){Disney.Social.unbindAll("#D_F_AddFriendResults");$("#D_F_AddFriendResults").empty();Disney.Social.unbindAll("#D_F_AddFriendGrid");$("#D_F_AddFriendGrid").empty();this.scroller.hide();$("#D_F_AddFriendMessage").show();this.searchName||$("#D_F_AddFriendFinderFieldDef").show()},updateGrid:function(a){var b=$("#D_F_AddFriendGrid");$.each(a,function(d,c){b.append(Disney.Friends.UI.AddFriend.getFriendHTML(c))});
b.show();$("#D_F_AddFriendResults").css("display","none");if(a=b.children().length){$("#D_F_AddFriendMessage").css("display","none");if(a>3){this.scroller.show();this.scroller.resize();this.scroller.scrollToTop();this.scroller.bindMousewheel()}else{this.scroller.hide();this.scroller.scrollToTop();this.scroller.unbindMousewheel()}}else{$("#D_F_AddFriendMessage").show();this.scroller.hide()}},getFriendHTML:function(a){var b=Disney.Friends.UI,d=$("#D_F_FriendsPanel").data(a),c=$("#D_F_AddFriendResultsTileTemplate").contents().clone(true),
e=$(c).find(".D_F_AddFriendResultsTileAvatarCard"),h=$(c).find(".D_F_AddFriendFavorite");c.find("input[type=hidden]").val(a);b.getAvatarUriByFriendId(c.find(".D_F_AddFriendResultsTileAvatar"),a,d.Id,88,true);if(d.status===Disney.Friends.Presence.Status.ONLINE){$(e).addClass("D_F_AvatarBg");c.find(".D_F_FriendAvatarMask").show();c.find(".D_F_FriendAvatarOff").css("display","none");a.indexOf("character_")===false&&$(c).find(".D_F_AddFriendJumpButton").show().click(function(g){Disney.Social.stopEvent(g);
Disney.Friends.UI.FriendsTile.jumpToFriend(a)});d.roomID&&Disney.Social.Data.rooms&&Disney.Social.Data.rooms[d.roomID]&&$(c).find(".D_F_AddFriendRoom").html(Disney.Social.Data.rooms[d.roomID].short_name)}else{c.find(".D_F_FriendAvatarOff, .D_F_FriendAvatarMask").show();$(e).addClass("D_F_AvatarBg");$(c).find(".D_F_AddFriendResultsTileJumpStatus .D_F_AddFriendStatus").show().html(b.setText("D15"))}$(e).click(function(g){Disney.Social.stopEvent(g);Disney.Friends.UI.showPlayerCard(a)});this.updateBestFriend(h,
a);c.find(".D_F_AddFriendResultsTileName").html(d.name);return c},toggleBest:function(a){a=$(a).siblings("input[type=hidden]").val();Disney.Friends.UI.setBestFriend(a)},updateBestFriend:function(a,b,d){d===1||d===undefined&&this.isBestFriend(b)?Disney.Friends.UI.Images.setAttrs(a,"20",false):Disney.Friends.UI.Images.setAttrs(a,"22",false)},isBestFriend:function(a){a=$("#D_F_FriendsPanel").data(a).type;var b=Disney.Friends.UI.Friends;return a===b.BEST_CHARACTER||a===b.BEST_FRIEND},updateSearchTile:function(a){Disney.Friends.UI.AddFriend.updateBestFriend($("#D_F_AddFriendResults").find("input[value='"+
a+"']").siblings(".D_F_AddFriendFavorite"),a)},openPanel:function(){Disney.Metrics.startDurationMetric(Disney.Metrics.Type.ADD_FRIEND,[Disney.Metrics.Type.ADD_FRIEND_SEARCHES,Disney.Metrics.Type.ADD_FRIEND_SUCCESSES]);this.setMode();this.clearFilterResults();this.searching=false;$("#D_F_AddFriendError").empty().css("display","none");$("#D_F_AddFriendResults").css("display","none");$("#D_F_AddFriendGrid").css("display","none");$("#D_F_AddFriendBusy").css("display","none");this.mode===this.modes.FULL&&
$("#D_F_AddFriendDivider").show();$("#D_F_AddFriendMessage, #D_F_AddFriendClose").show();$("#D_F_AddFriendPanel").show();this.resetPlacehoder();this.resize();$("#D_F_AddFriendFinderField").focus(function(){Disney.Friends.UI.AddFriend.showExpanded()});$("#D_F_AddFriendFinder").keydown(function(a){Disney.Friends.UI.AddFriend.keyDown(a)}).keyup(function(a){Disney.Friends.UI.AddFriend.keyUp(a)})},showAddFriend:function(a){var b=Disney.Friends.UI.Friends;this.setMode();if(this.mode!==this.modes.STANDALONE)return false;
this.openPanel();a=$(a).parent().position().top/b.TILE_HEIGHT;switch(Math.floor(a)){case 0:$("#D_F_AddFriendPanel").css("bottom","").css("top","40px");break;case 1:$("#D_F_AddFriendPanel").css("bottom","").css("top","150px");break;case 2:$("#D_F_AddFriendPanel").css("top","").css("bottom","7px")}Disney.Friends.UI.AddFriend.setFocus();this.showExpanded();this.resize()},showExpanded:function(){if($("#D_F_AddFriendExpanded").show())return false;this.clearFilterResults();this.resetPlacehoder();$("#D_F_AddFriendError").empty().css("display",
"none");$("#D_F_AddFriendResults").css("display","none");$("#D_F_AddFriendGrid").css("display","none");Disney.Friends.UI.setTagText($("#D_F_AddFriendMessage").get(0));$("#D_F_AddFriendPanel").css("height","150px");$("#D_F_AddFriendExpanded").show();$("#D_F_AddFriendDivider").css("display","none");$("#D_F_AddFriendMessage, #D_F_AddFriendClose").show()},closePanel:function(){Disney.Metrics.endDurationMetric(Disney.Metrics.Type.ADD_FRIEND);var a=Disney.Friends.UI.AddFriend;a.resize();$("#D_F_AddFriendFinderField").val("").blur();
a.clearFilterResults();a.resetPlacehoder();a.searching=false;$("#D_F_AddFriendExpanded").css("display","none");$("#D_F_AddFriendBusy").css("display","none");$("#D_F_AddFriendError").empty().css("display","none");if(a.mode===a.modes.STANDALONE){$("#D_F_AddFriendFinder").unbind("keyup").unbind("keydown");$("#D_F_AddFriendPanel").css("display","none")}else if(a.mode===a.modes.FULL){$("#D_F_AddFriendDivider").show();$("#D_F_AddFriendPanel").css("height","15px")}},setMode:function(){this.mode=this.friendsCount<
9?this.modes.STANDALONE:this.modes.FULL},resize:function(){this.setMode();if(this.mode===this.modes.STANDALONE&&this.friendsCount>5){$("#D_F_AddFriendPanel, .D_F_AddFriendExpanded_BoxW20").css("width","264px");$("#D_F_AddFriendPanel").css({height:"150px",left:"8px"});$("#D_F_AddFriendDivider").css("width",($("#D_F_FriendSection").width()+32).toString()+"px")}else if(this.mode===this.modes.FULL){$("#D_F_AddFriendPanel").css({width:$("#D_F_FriendSection").width().toString()+"px",left:"0px",top:"auto"});
$(".D_F_AddFriendExpanded_BoxW20").css("width",$("#D_F_FriendSection").width().toString()+"px");$("#D_F_AddFriendPanel").css("height","15px");$("#D_F_AddFriendDivider").css("width",($("#D_F_FriendSection").width()+32).toString()+"px")}else{$("#D_F_AddFriendPanel").css({width:"164px",left:"8px"});$(".D_F_AddFriendExpanded_BoxW20").css("width","164px");$("#D_F_AddFriendPanel").css("height","150px")}this.resizeFinder()},resizeFinder:function(){var a=$("#D_F_AddFriendFinderFind");a.css("width",($("#D_F_AddFriendBtnText").width()+
10).toString()+"px");a=a.parent().width()-(a.width()+30);if(a<80)a=80;$("#D_F_AddFriendFinderInput").css("width",a.toString()+"px");$("#D_F_AddFriendFinderField").css("width",a.toString()+"px");$("#D_F_AddFriendFinderFieldDef").css("width",(a-4).toString()+"px")},findPlayer:function(a){if(!a)return false;this.searchName=a;var b=this.getCharacter(a);if(b[0]>-1){this.foundCharacter(b[0],b[1]);return false}$("#D_F_AddFriendResults").css("display","none");$("#D_F_AddFriendGrid").css("display","none");
this.scroller.hide();Disney.Friends.API.findPlayerByName(a)},getCharacter:function(a){var b=-1,d=a,c=Disney.Social.Data.mascots,e;for(e in c)if(c.hasOwnProperty(e))if(c[e].name.toLowerCase()===a.toLowerCase()){b=c[e].mascot_id;d=c[e].name;break}return[b,d]},foundPlayer:function(a){if(!this.searching)return false;var b=Disney.Friends.UI;$("#D_F_AddFriendBusy").css("display","none");if(a===undefined||a===null||a.swid===undefined||a.swid===null||a.name===undefined||a.name===null){this.showError(b.setText("D17"));
this.resetPlacehoder();return false}if(a.swid===Disney.Friends.activeConnection.swid){this.showError(b.setText("D18"));return false}var d=$("#D_F_AddFriendResults");Disney.Social.unbindAll("#D_F_AddFriendResults");d.empty().append($("#D_F_AddFriendResultItemTemplate").contents().clone(true));var c=$(d).find(".D_F_AddFriendItemName")[0],e=$(d).find(".D_F_AddFriendItemAvatar")[0];d=$(d).find("input")[0];var h=Disney.Metrics,g=h.Type;$(c).text(a.name);b.getAvatarUriByFriendId(e,a.swid,a.playerId,60,
false);$(d).attr("value",a.swid);$("#D_F_AddFriendMessage").css("display","none");$("#D_F_AddFriendResults").show();this.resetPlacehoder();this.scroller.hide();h.incrementCounter(g.ADD_FRIEND,g.ADD_FRIEND_SUCCESSES)},foundPlayerExisting:function(a){if(!this.searching)return false;this.showError(Disney.Friends.UI.setText("D19").replace("{0}",a))},foundPlayerIgnored:function(a){if(!this.searching)return false;this.showError(Disney.Friends.UI.setText("D20").replace("{0}",a))},foundCharacter:function(a,
b){if(!this.searching)return false;$("#D_F_AddFriendBusy").css("display","none");var d,c=Disney.Social.Data.characters;if(c.hasOwnProperty(a)&&c[a].info)d=c[a].info;else{this.playerNotFound(b);return false}var e=0;if(c.hasOwnProperty(a)&&c[a].img)e=c[a].img;this.clearFilterResults();c=$("#D_F_AddFriendResults");c.empty().append($("#D_F_AddFriendResultCharTemplate").contents().clone(true));var h=false;if($("#D_F_AddFriendPanel").width()>=280)h=true;var g=$(c).find("input")[0],m=$(c).find(".D_F_AddFriendChar")[0],
j=$(c).find(".D_F_AddFriendCharCard")[0],n=$(c).find(".D_F_FriendAvatarMask")[0],k=$(c).find(".D_F_AddFriendCharAvatar")[0],i=$(c).find(".D_F_AddFriendCharInfo")[0],f="character_"+a.toString();$(g).attr("value",f);if(e>0){if(h){$(j).css("width","83px").css("height","83px");$(n).show();$(k).attr("width","88").attr("height","88").css("left","-3px").css("top","-3px");Disney.Friends.UI.getAvatarUriByFriendId(k,f,a,88,false)}else{$(n).css("display","none");$(k).attr("width","60").attr("height","60").css("left",
"0px").css("top","0px");$(j).css("width","60px").css("height","60px");Disney.Friends.UI.getAvatarUriByFriendId(k,f,a,60,false)}$(j).show();$(i).css("left","40%");$(m).css("left","0");c.css("left","0px")}else{$(j).css("display","none");$(i).css("left","21%");$(m).css("left","5px");c.css("left","0")}$(i).text(d).show();$("#D_F_AddFriendMessage").css("display","none");$("#D_F_AddFriendResults").show();this.scroller.hide();this.setFocus()},playerNotFound:function(a){if(!this.searching)return false;if(!a)a=
this.searchName;this.showError(Disney.Friends.UI.setText("D17").replace("{0}",a))},showError:function(a){$("#D_F_AddFriendBusy, #D_F_AddFriendMessage").css("display","none");$("#D_F_AddFriendError").empty().text(a).show();$("#D_F_AddFriendError").css("top",($("#D_F_AddFriendError").parent().height()-$("#D_F_AddFriendError").height()-20)/2)},addRequest:function(a){if(a===undefined||a===null)return false;Disney.Friends.API.requestFriendship(a)},togglePanel:function(){if(this.friendsCount>8)$("#D_F_AddFriendPanel").css("display")===
"none"&&Disney.Friends.UI.AddFriend.openPanel();else $("#D_F_AddFriendPanel").css("display")!=="none"&&Disney.Friends.UI.AddFriend.closePanel();var a=Disney.Friends.UI.Event;a.updateListeners(a.SUBPANEL_TOGGLED)}};$(function(){Disney.Social.ieVer=DISNEY_FRIENDS_INI.ieVer;Disney.Friends.UI.setLayout();$(window).unload(function(){$(window).unbind();$("#D_F_FriendSection").css("display","none");$("#D_F_HudNotification").css("display","none");return false})});

}
/*
     FILE ARCHIVED ON 00:46:21 Jan 09, 2013 AND RETRIEVED FROM THE
     INTERNET ARCHIVE ON 18:26:14 Feb 09, 2021.
     JAVASCRIPT APPENDED BY WAYBACK MACHINE, COPYRIGHT INTERNET ARCHIVE.

     ALL OTHER CONTENT MAY ALSO BE PROTECTED BY COPYRIGHT (17 U.S.C.
     SECTION 108(a)(3)).
*/
/*
playback timings (ms):
  captures_list: 357.679
  RedisCDXSource: 1.843
  CDXLines.iter: 21.084 (3)
  exclusion.robots.policy: 0.125
  esindex: 0.014
  PetaboxLoader3.datanode: 1402.884 (4)
  LoadShardBlock: 330.567 (3)
  PetaboxLoader3.resolve: 118.555 (2)
  exclusion.robots: 0.135
  load_resource: 1227.891
*/